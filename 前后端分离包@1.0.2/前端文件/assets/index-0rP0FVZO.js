var te=Object.defineProperty,le=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var S=(s,l,r)=>l in s?te(s,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[l]=r,F=(s,l)=>{for(var r in l||(l={}))oe.call(l,r)&&S(s,r,l[r]);if(O)for(var r of O(l))ne.call(l,r)&&S(s,r,l[r]);return s},W=(s,l)=>le(s,ae(l));var C=(s,l,r)=>new Promise((_,b)=>{var V=n=>{try{y(r.next(n))}catch(x){b(x)}},v=n=>{try{y(r.throw(n))}catch(x){b(x)}},y=n=>n.done?_(n.value):Promise.resolve(n.value).then(V,v);y((r=r.apply(s,l)).next())});import{r as f,u as q,o as k,c as U,w as e,a as se,b as p,F as M,G as P,p as z,d as t,e as g,a7 as L,a8 as G,f as H,g as N,h as Q,s as R,m as re,i as de,q as I,E as ue,W as ie,l as ce,x as pe,Q as me,t as K,z as fe,k as _e,C as ve,D as ge}from"./index-DKVio5DX.js";import{i as J}from"./index-1zv9CzUI.js";import{i as ye}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as be}from"./text-lzaRNwcJ.js";import{E as X,a as Y}from"./col-Ru1YGmP5.js";import{l as Z}from"./index--y5nxKK5.js";import{i as Ve}from"./index-C8m5DZvo.js";const xe={__name:"search-form",emits:["search"],setup(s,{emit:l}){const r=l,_=f([]);Z().then(n=>{_.value=n}).catch(n=>{EleMessage.error(n.message)});const{form:b,resetFields:V}=q({softId:""}),v=()=>{r("search",b)},y=()=>{V(),v()};return(n,x)=>{const w=L,D=G,E=H,d=X,o=N,a=Y,c=Q,h=J;return k(),U(h,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(c,{"label-width":"72px",onKeyup:se(v,["enter"])},{default:e(()=>[t(a,{gutter:8},{default:e(()=>[t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(E,{label:"软件名称",prop:"softId"},{default:e(()=>[t(D,{clearable:"",modelValue:p(b).softId,"onUpdate:modelValue":x[0]||(x[0]=i=>p(b).softId=i),placeholder:"不限",class:"ele-fluid"},{default:e(()=>[(k(!0),z(M,null,P(_.value,i=>(k(),U(w,{key:i.softId,value:i.softId,label:i.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(E,{"label-width":"16px"},{default:e(()=>[t(o,{type:"primary",onClick:v},{default:e(()=>[g("查询")]),_:1}),t(o,{onClick:y},{default:e(()=>[g("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};function he(s){return C(this,null,function*(){const l=yield R.get("/soft/variable/page",{params:s});return l.data.code===0?l.data.data:Promise.reject(new Error(l.data.message))})}function we(s){return C(this,null,function*(){const l=yield R.post("/soft/variable/save",s);return l.data.code===0?l.data.message:Promise.reject(new Error(l.data.message))})}function Ee(s){return C(this,null,function*(){const l=yield R.put("/soft/variable/update",s);return l.data.code===0?l.data.message:Promise.reject(new Error(l.data.message))})}function ke(s){return C(this,null,function*(){const l=yield R.delete("/soft/variable/remove",{data:s});return l.data.code===0?l.data.message:Promise.reject(new Error(l.data.message))})}const De={__name:"form-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(s,{emit:l}){const r=l,_=s,b=f([]);Z().then(o=>{b.value=o});const V=f(!1),v=f(!1),y=f(null),{form:n,resetFields:x,assignFields:w}=q({id:void 0,softId:void 0,vKey:"",vValue:"",vType:void 0,vRead:void 0,vWrite:void 0,vDel:void 0,vAlter:void 0}),D=re({vKey:[{required:!0,message:"请输入变量名",type:"string",trigger:"blur"}],softId:[{required:!0,message:"请选择变量绑定软件",type:"number",trigger:"blur"}],vValue:[{required:!0,message:"请输入变量值",type:"string",trigger:"blur"}]}),E=()=>{var o,a;(a=(o=y.value)==null?void 0:o.validate)==null||a.call(o,c=>{if(!c)return;v.value=!0,(V.value?Ee:we)(n).then(i=>{v.value=!1,I.success(i),d(!1),r("done")}).catch(i=>{v.value=!1,I.error(i.message)})})},d=o=>{r("update:modelValue",o)};return de(()=>_.modelValue,o=>{var a,c;o?_.data?(w(W(F({},_.data),{password:""})),V.value=!0):V.value=!1:(x(),(c=(a=y.value)==null?void 0:a.clearValidate)==null||c.call(a))}),(o,a)=>{const c=L,h=G,i=H,$=ue,T=ie,j=X,B=Y,u=Q,A=N,ee=ce;return k(),U(ee,{form:"",width:640,"model-value":s.modelValue,title:V.value?"修改变量":"添加变量","onUpdate:modelValue":d},{footer:e(()=>[t(A,{onClick:a[6]||(a[6]=m=>d(!1))},{default:e(()=>[g("取消")]),_:1}),t(A,{type:"primary",loading:v.value,onClick:E},{default:e(()=>[g(" 保存 ")]),_:1},8,["loading"])]),default:e(()=>[t(u,{ref_key:"formRef",ref:y,model:p(n),rules:D,"label-width":"80px"},{default:e(()=>[t(B,{gutter:16},{default:e(()=>[t(j,{sm:24,xs:24},{default:e(()=>[t(i,{label:"归属软件",prop:"softId"},{default:e(()=>[t(h,{clearable:"",modelValue:p(n).softId,"onUpdate:modelValue":a[0]||(a[0]=m=>p(n).softId=m),placeholder:"请选择变量绑定软件",class:"ele-fluid"},{default:e(()=>[(k(!0),z(M,null,P(b.value,m=>(k(),U(c,{key:m.softId,value:m.softId,label:m.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"变量名",prop:"vKey"},{default:e(()=>[t($,{clearable:"",maxlength:20,modelValue:p(n).vKey,"onUpdate:modelValue":a[1]||(a[1]=m=>p(n).vKey=m),placeholder:"请输入变量名"},null,8,["modelValue"])]),_:1}),t(i,{label:"验证登录",prop:"vType"},{default:e(()=>[t(T,{code:"soft_variable_type",modelValue:p(n).vType,"onUpdate:modelValue":a[2]||(a[2]=m=>p(n).vType=m)},null,8,["modelValue"])]),_:1}),t(i,{label:"接口[修改]",prop:"vAlter"},{default:e(()=>[t(T,{code:"soft_variable_alter_type",modelValue:p(n).vAlter,"onUpdate:modelValue":a[3]||(a[3]=m=>p(n).vAlter=m)},null,8,["modelValue"])]),_:1}),t(i,{label:"接口[删除]",prop:"vDel"},{default:e(()=>[t(T,{code:"soft_variable_del_type",modelValue:p(n).vDel,"onUpdate:modelValue":a[4]||(a[4]=m=>p(n).vDel=m)},null,8,["modelValue"])]),_:1}),t(i,{label:"变量值",prop:"vValue"},{default:e(()=>[t($,{type:"textarea",rows:6,modelValue:p(n).vValue,"onUpdate:modelValue":a[5]||(a[5]=m=>p(n).vValue=m),placeholder:"请输入变量值"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Ie={name:"SoftCarmit"},Be=Object.assign(Ie,{setup(s){const l=f(null),r=f([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"vKey",label:"变量名",minWidth:220,slot:"vKey"},{prop:"vValue",label:"变量值",minWidth:200},{prop:"vType",label:"登录验证",width:100,align:"center",slot:"vType"},{prop:"vAlter",label:"接口[修改]",width:100,align:"center",slot:"vAlter"},{prop:"vDel",label:"接口[删除]",width:100,align:"center",slot:"vDel"},{prop:"vRead",label:"读取次数",width:120,align:"center",formatter:d=>d.vRead+"次"},{prop:"vWrite",label:"写入次数",width:120,align:"center",formatter:d=>d.vWrite+"次"},{prop:"createTime",label:"创建时间",align:"center",width:160},{prop:"updateTime",label:"修改时间",align:"center",width:160},{columnKey:"action",label:"操作",width:130,align:"center",slot:"action",fixed:"right"}]),_=f([]),b=f(!0),V=f(!1);f(!0);const v=f(!0),y=f(null),n=f(!1),x=({page:d,limit:o,where:a,orders:c})=>he(W(F(F({},a),c),{page:d,limit:o})),w=d=>{var o,a;_.value=[],(a=(o=l.value)==null?void 0:o.reload)==null||a.call(o,{page:1,where:d})},D=d=>{y.value=d!=null?d:null,n.value=!0},E=d=>{const o=d==null?_.value:[d];if(!o.length){I.error("请至少选择一条数据");return}fe.confirm("确定要删除“"+o.map(a=>a.vKey).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=I.loading("请求中..");ke(o.map(c=>c.id)).then(c=>{a.close(),I.success(c),w()}).catch(c=>{a.close(),I.error(c.message)})}).catch(()=>{})};return(d,o)=>{const a=N,c=_e,h=be,i=ve,$=ge,T=ye,j=J,B=Ve;return k(),U(B,{"hide-footer":"","flex-table":v.value},{default:e(()=>[t(xe,{onSearch:w}),t(j,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":v.value},{default:e(()=>[t(T,{ref_key:"tableRef",ref:l,"row-key":"id",columns:r.value,datasource:x,"show-overflow-tooltip":!0,selections:_.value,"onUpdate:selections":o[2]||(o[2]=u=>_.value=u),"highlight-current-row":"","cache-key":"systemUserTable",stripe:V.value,border:b.value,pagination:{pageSize:20}},{toolbar:e(()=>[t(a,{type:"primary",class:"ele-btn-icon",icon:p(pe),onClick:o[0]||(o[0]=u=>D())},{default:e(()=>[g(" 添加 ")]),_:1},8,["icon"]),t(a,{type:"danger",class:"ele-btn-icon",icon:p(me),onClick:o[1]||(o[1]=u=>E())},{default:e(()=>[g(" 删除 ")]),_:1},8,["icon"])]),vKey:e(({row:u})=>[t(c,{size:"small",class:"ml-2",type:"info"},{default:e(()=>[g(K(u.softName),1)]),_:2},1024),g(" "+K(u.vKey),1)]),vType:e(({row:u})=>[t(h,{class:"mx-1",type:u.vType_style},{default:e(()=>[g(K(u.vTypes),1)]),_:2},1032,["type"])]),vAlter:e(({row:u})=>[t(h,{class:"mx-1",type:u.vAlter_style},{default:e(()=>[g(K(u.vAlters),1)]),_:2},1032,["type"])]),vDel:e(({row:u})=>[t(h,{class:"mx-1",type:u.vDel_style},{default:e(()=>[g(K(u.vDels),1)]),_:2},1032,["type"])]),action:e(({row:u})=>[t(i,{type:"primary",underline:!1,onClick:A=>D(u)},{default:e(()=>[g(" 修改 ")]),_:2},1032,["onClick"]),t($,{direction:"vertical"}),t(i,{type:"danger",underline:!1,onClick:A=>E(u)},{default:e(()=>[g(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections","stripe","border"])]),_:1},8,["flex-table"]),t(De,{modelValue:n.value,"onUpdate:modelValue":o[3]||(o[3]=u=>n.value=u),data:y.value,onDone:w},null,8,["modelValue","data"])]),_:1},8,["flex-table"])}}});export{Be as default};
