var de=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var Z=(h,p,b)=>p in h?de(h,p,{enumerable:!0,configurable:!0,writable:!0,value:b}):h[p]=b,R=(h,p)=>{for(var b in p||(p={}))ie.call(p,b)&&Z(h,b,p[b]);if(X)for(var b of X(p))pe.call(p,b)&&Z(h,b,p[b]);return h},D=(h,p)=>ue(h,me(p));import{u as N,o as w,c as C,w as l,a as ce,b as o,d as e,e as V,E as q,f as z,W as le,g as F,h as O,v as _e,r as I,q as U,F as P,G as Y,p as j,a7 as fe,a8 as ge,_ as be,m as H,i as ye,n as J,t as K,X as Ve,Y as he,k as te,l as ve,Z as xe,x as ke,Q as we,z as ee,C as Ue,$ as Ee,D as Ie}from"./index-DKVio5DX.js";import{i as ae}from"./index-1zv9CzUI.js";import{i as Ce}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{i as $e}from"./index--bFGqZaq.js";import{E as G,a as L}from"./col-Ru1YGmP5.js";import{E as Se}from"./date-picker-F14weS8C.js";import"./index-oGUME3om.js";import{i as Te}from"./index-ai46_yFm.js";/* empty css                     */import{c as Re}from"./index-u9YAvNP5.js";import{p as De,u as Fe,a as Me,b as Be,r as We,c as Ke,d as Ne}from"./index-7IXGg2mp.js";import{e as qe}from"./validate-Horigie2.js";import{i as ze}from"./index-C8m5DZvo.js";import"./index-8oT0IIFa.js";const Oe={__name:"user-search",emits:["search"],setup(h,{emit:p}){const b=p,{form:f,resetFields:E}=N({username:"",nickname:"",sex:void 0}),v=()=>{b("search",f)},$=()=>{E(),v()};return(m,c)=>{const x=q,a=z,k=G,r=le,n=F,_=L,d=O,i=ae;return w(),C(i,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[e(d,{"label-width":"72px",onKeyup:ce(v,["enter"])},{default:l(()=>[e(_,{gutter:8},{default:l(()=>[e(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(a,{label:"用户账号"},{default:l(()=>[e(x,{clearable:"",modelValue:o(f).username,"onUpdate:modelValue":c[0]||(c[0]=t=>o(f).username=t),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(a,{label:"用户名"},{default:l(()=>[e(x,{clearable:"",modelValue:o(f).nickname,"onUpdate:modelValue":c[1]||(c[1]=t=>o(f).nickname=t),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(a,{label:"性别"},{default:l(()=>[e(r,{code:"sex",modelValue:o(f).sex,"onUpdate:modelValue":c[2]||(c[2]=t=>o(f).sex=t),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(a,{"label-width":"16px"},{default:l(()=>[e(n,{type:"primary",onClick:v},{default:l(()=>[V("查询")]),_:1}),e(n,{onClick:$},{default:l(()=>[V("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Pe={__name:"role-select",props:{modelValue:Array,placeholder:{type:String,default:"请选择角色"}},emits:["update:modelValue"],setup(h,{emit:p}){const b=p,f=h,E=_e(()=>{var m,c;return(c=(m=f.modelValue)==null?void 0:m.map)==null?void 0:c.call(m,x=>x.roleId)}),v=I([]),$=m=>{b("update:modelValue",m.map(c=>({roleId:c})))};return Re().then(m=>{v.value=m}).catch(m=>{U.error(m.message)}),(m,c)=>{const x=fe,a=ge;return w(),C(a,{multiple:"",clearable:"","multiple-limit":1,"model-value":E.value,placeholder:h.placeholder,class:"ele-fluid","onUpdate:modelValue":$},{default:l(()=>[(w(!0),j(P,null,Y(v.value,k=>(w(),C(x,{key:k.roleId,value:k.roleId,label:k.roleName},null,8,["value","label"]))),128))]),_:1},8,["model-value","placeholder"])}}},Ye={__name:"tpluser-search",emits:["search"],setup(h,{emit:p}){const b=p,{form:f,resetFields:E}=N({username:""}),v=()=>{b("search",f)},$=()=>{E(),v()};return(m,c)=>{const x=q,a=z,k=G,r=F,n=L,_=O;return w(),C(_,{"label-width":"60px",size:"small",class:"demo-search"},{default:l(()=>[e(n,null,{default:l(()=>[e(k,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(a,{label:"用户账号"},{default:l(()=>[e(x,{clearable:"",modelValue:o(f).username,"onUpdate:modelValue":c[0]||(c[0]=d=>o(f).username=d),modelModifiers:{trim:!0},placeholder:`请输入
`},null,8,["modelValue"])]),_:1})]),_:1}),e(k,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(a,{"label-width":"12px"},{default:l(()=>[e(r,{type:"primary",onClick:v},{default:l(()=>[V("查询")]),_:1}),e(r,{onClick:$},{default:l(()=>[V("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},je=be(Ye,[["__scopeId","data-v-d87f5c9e"]]),Ge={__name:"user-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(h,{emit:p}){const b=p,f=h,E=I(null),v=H({datasource:({page:i,limit:t,where:u,orders:g})=>De(D(R(R({},u),g),{page:i,limit:t})),columns:[{prop:"userId",label:"ID",width:80,align:"center",fixed:"left"},{prop:"username",label:"账号",minwidth:180},{prop:"nickname",label:"用户名称",minwidth:120},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles"}],showOverflowTooltip:!0,toolbar:!1,pagination:{pageSize:6,layout:"total, prev, pager, next, jumper",style:{padding:"0px"}},rowClickChecked:!0}),$=i=>{var t,u,g;(g=(u=(t=E.value)==null?void 0:t.tableRef)==null?void 0:u.reload)==null||g.call(u,{where:i,page:1})},m=I(!1),c=I(!1),x=I(null),{form:a,resetFields:k,assignFields:r}=N({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:"",birthday:"",money:void 0,consume:void 0,userType:"",createId:void 0,money2:void 0}),n=H({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"}],userType:[{required:!0,message:"请选择账户类型",type:"string",trigger:"blur"}],createId:[{required:!0,message:"请选择归属作者",type:"number",trigger:"blur"}],roles:[{required:!0,message:"请选择权限角色",type:"array",trigger:"blur"}],email:[{pattern:qe,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(i,t,u)=>{if(m.value||/^[\S]{5,18}$/.test(t))return u();u(new Error("密码必须为5-18位非空白字符"))}}]}),_=()=>{var i,t;(t=(i=x.value)==null?void 0:i.validate)==null||t.call(i,u=>{if(!u)return;c.value=!0,(m.value?Fe:Me)(a).then(S=>{c.value=!1,U.success(S),d(!1),b("done")}).catch(S=>{c.value=!1,U.error(S.message)})})},d=i=>{b("update:modelValue",i)};return ye(()=>f.modelValue,i=>{var t,u;i?f.data?(r(D(R({},f.data),{password:""})),m.value=!0):m.value=!1:(k(),(u=(t=x.value)==null?void 0:t.clearValidate)==null||u.call(t))}),(i,t)=>{const u=q,g=z,S=Ve,M=he,B=te,W=Te,y=G,T=le,oe=Se,ne=L,se=O,A=F,re=ve;return w(),C(re,{form:"",width:640,"model-value":h.modelValue,title:m.value?"修改用户":"新建用户","onUpdate:modelValue":d},{footer:l(()=>[e(A,{onClick:t[14]||(t[14]=s=>d(!1))},{default:l(()=>[V("取消")]),_:1}),e(A,{type:"primary",loading:c.value,onClick:_},{default:l(()=>[V(" 保存 ")]),_:1},8,["loading"])]),default:l(()=>[e(se,{ref_key:"formRef",ref:x,model:o(a),rules:n,"label-width":"80px"},{default:l(()=>[e(ne,{gutter:16},{default:l(()=>[e(y,{sm:12,xs:24},{default:l(()=>[e(g,{label:"用户账号",prop:"username"},{default:l(()=>[e(u,{clearable:"",maxlength:20,modelValue:o(a).username,"onUpdate:modelValue":t[0]||(t[0]=s=>o(a).username=s),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),m.value?J("",!0):(w(),C(g,{key:0,label:"登录密码",prop:"password"},{default:l(()=>[e(u,{"show-password":"",type:"password",maxlength:20,modelValue:o(a).password,"onUpdate:modelValue":t[1]||(t[1]=s=>o(a).password=s),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(g,{label:"权限角色",prop:"roles"},{default:l(()=>[e(Pe,{modelValue:o(a).roles,"onUpdate:modelValue":t[2]||(t[2]=s=>o(a).roles=s)},null,8,["modelValue"])]),_:1}),e(g,{label:"账户余额",prop:"money"},{default:l(()=>[e(u,{clearable:"",maxlength:11,modelValue:o(a).money,"onUpdate:modelValue":t[3]||(t[3]=s=>o(a).money=s),placeholder:"请输入账户余额"},{append:l(()=>[V("￥")]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"账户消费",prop:"consume"},{default:l(()=>[e(u,{clearable:"",maxlength:11,modelValue:o(a).consume,"onUpdate:modelValue":t[4]||(t[4]=s=>o(a).consume=s),placeholder:"请输入账户已消费金额"},{append:l(()=>[V("￥")]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"可用电量",prop:"money2"},{default:l(()=>[e(u,{clearable:"",maxlength:11,modelValue:o(a).money2,"onUpdate:modelValue":t[5]||(t[5]=s=>o(a).money2=s),placeholder:"请输入账户可用电量"},{append:l(()=>[V("⚡")]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"账户级别",prop:"userType"},{default:l(()=>[e(M,{modelValue:o(a).userType,"onUpdate:modelValue":t[6]||(t[6]=s=>o(a).userType=s)},{default:l(()=>[e(S,{label:"0"},{default:l(()=>[V("平台账户")]),_:1}),e(S,{label:"1"},{default:l(()=>[V("子级账户")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(a).userType==1?(w(),C(g,{key:1,label:"归属作者",prop:"createId"},{default:l(()=>[e(W,{ref_key:"selectRef",ref:E,clearable:"",placeholder:"请选择归属作者","value-key":"userId","label-key":"username",modelValue:o(a).createId,"onUpdate:modelValue":t[7]||(t[7]=s=>o(a).createId=s),"table-props":v,"popper-width":580,disabled:i.disabled,"init-value":i.initValue,onSelect:i.onSelect},{roles:l(({row:s})=>[(w(!0),j(P,null,Y(s.roles,Q=>(w(),C(B,{key:Q.roleId,size:"small","disable-transitions":!0,style:{"margin-right":"6px"}},{default:l(()=>[V(K(Q.roleName),1)]),_:2},1024))),128))]),default:l(()=>[e(je,{onSearch:$})]),_:1},8,["modelValue","table-props","disabled","init-value","onSelect"])]),_:1})):J("",!0)]),_:1}),e(y,{sm:12,xs:24},{default:l(()=>[e(g,{label:"用户名",prop:"nickname"},{default:l(()=>[e(u,{clearable:"",maxlength:20,modelValue:o(a).nickname,"onUpdate:modelValue":t[8]||(t[8]=s=>o(a).nickname=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(g,{label:"性别",prop:"sex"},{default:l(()=>[e(T,{code:"sex",modelValue:o(a).sex,"onUpdate:modelValue":t[9]||(t[9]=s=>o(a).sex=s),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(g,{label:"出生日期"},{default:l(()=>[e(oe,{modelValue:o(a).birthday,"onUpdate:modelValue":t[10]||(t[10]=s=>o(a).birthday=s),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),e(g,{label:"邮箱",prop:"email"},{default:l(()=>[e(u,{clearable:"",maxlength:100,modelValue:o(a).email,"onUpdate:modelValue":t[11]||(t[11]=s=>o(a).email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(g,{label:"手机号",prop:"phone"},{default:l(()=>[e(u,{clearable:"",maxlength:11,modelValue:o(a).phone,"onUpdate:modelValue":t[12]||(t[12]=s=>o(a).phone=s),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{sm:24,xs:24},{default:l(()=>[e(g,{label:"个人简介"},{default:l(()=>[e(u,{type:"textarea",rows:3,maxlength:200,modelValue:o(a).introduction,"onUpdate:modelValue":t[13]||(t[13]=s=>o(a).introduction=s),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Le={name:"SystemUser"},ml=Object.assign(Le,{setup(h){const p=I(null),b=I([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",minWidth:130},{prop:"nickname",label:"用户名",minWidth:110,slot:"nickname"},{prop:"status",label:"状态",width:90,align:"center",slot:"status"},{columnKey:"roles",label:"权限角色",minWidth:110,slot:"roles"},{prop:"money",label:"余额",width:100,align:"center",formatter:r=>r.money+"￥"},{prop:"consume",label:"消费",width:100,align:"center",formatter:r=>r.consume+"￥"},{prop:"sexName",label:"性别",width:90,align:"center"},{prop:"phone",label:"手机号",minWidth:140},{prop:"createTime",label:"创建时间",minWidth:170},{prop:"loginTime",label:"登录时间",minWidth:170},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",fixed:"right"}]),f=I([]),E=I(null),v=I(!1);I(!1);const $=({page:r,limit:n,where:_,orders:d})=>Be(D(R(R({},_),d),{page:r,limit:n})),m=r=>{var n,_;f.value=[],(_=(n=p.value)==null?void 0:n.reload)==null||_.call(n,{page:1,where:r})},c=r=>{E.value=r!=null?r:null,v.value=!0},x=r=>{const n=r==null?f.value:[r];if(!n.length){U.error("请至少选择一条数据");return}ee.confirm("确定要删除“"+n.map(_=>_.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const _=U.loading("请求中..");We(n.map(d=>d.userId)).then(d=>{_.close(),U.success(d),m()}).catch(d=>{_.close(),U.error(d.message)})}).catch(()=>{})},a=r=>{ee.prompt(`请输入用户"${r.nickname}"的新密码：`,"提示",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",customStyle:{"--ele-message-box-body-padding":"4px 20px 0 20px"},draggable:!0}).then(({value:n})=>{const _=U.loading("请求中..");Ke(r.userId,n).then(d=>{_.close(),U.success(d)}).catch(d=>{_.close(),U.error(d.message)})}).catch(()=>{})},k=(r,n)=>{const _=r?0:1;Ne(n.userId,_).then(d=>{n.status=_,U.success(d)}).catch(d=>{U.error(d.message)})};return(r,n)=>{const _=$e,d=F,i=Ue,t=xe("router-link"),u=te,g=Ee,S=Ie,M=Ce,B=ae,W=ze;return w(),C(W,{"hide-footer":"","flex-table":!0},{default:l(()=>[e(Oe,{onSearch:m}),e(B,{"body-style":{padding:"10px 10px 10px 10px"},"flex-table":!0},{default:l(()=>[e(_,{title:"如非必要请勿修改已经正在使用的账户的级别和归属作者",type:"warning","show-icon":""}),e(M,{ref_key:"tableRef",ref:p,"row-key":"userId",columns:b.value,datasource:$,"show-overflow-tooltip":!0,selections:f.value,"onUpdate:selections":n[2]||(n[2]=y=>f.value=y),"highlight-current-row":"","cache-key":"systemUserTable"},{toolbar:l(()=>[e(d,{type:"primary",class:"ele-btn-icon",icon:o(ke),onClick:n[0]||(n[0]=y=>c())},{default:l(()=>[V(" 新建 ")]),_:1},8,["icon"]),e(d,{type:"danger",class:"ele-btn-icon",icon:o(we),onClick:n[1]||(n[1]=y=>x())},{default:l(()=>[V(" 删除 ")]),_:1},8,["icon"])]),nickname:l(({row:y})=>[e(t,{to:"/system/user/details?id="+y.userId,style:{"text-decoration":"none"}},{default:l(()=>[e(i,{type:"primary",underline:!1},{default:l(()=>[V(K(y.nickname),1)]),_:2},1024)]),_:2},1032,["to"])]),roles:l(({row:y})=>[(w(!0),j(P,null,Y(y.roles,T=>(w(),C(u,{key:T.roleId,size:"small","disable-transitions":!0,style:{"margin-right":"6px"}},{default:l(()=>[V(K(T.roleName),1)]),_:2},1024))),128))]),status:l(({row:y})=>[e(g,{size:"small","model-value":y.status===0,onChange:T=>k(T,y)},null,8,["model-value","onChange"])]),action:l(({row:y})=>[e(i,{type:"primary",underline:!1,onClick:T=>c(y)},{default:l(()=>[V(" 修改 ")]),_:2},1032,["onClick"]),e(S,{direction:"vertical"}),e(i,{type:"primary",underline:!1,onClick:T=>a(y)},{default:l(()=>[V(" 重置密码 ")]),_:2},1032,["onClick"]),e(S,{direction:"vertical"}),e(i,{type:"danger",underline:!1,onClick:T=>x(y)},{default:l(()=>[V(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1}),e(Ge,{modelValue:v.value,"onUpdate:modelValue":n[3]||(n[3]=y=>v.value=y),data:E.value,onDone:m},null,8,["modelValue","data"])]),_:1})}}});export{ml as default};
