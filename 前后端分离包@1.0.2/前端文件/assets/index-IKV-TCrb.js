var z=Object.defineProperty,A=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var B=(c,s,r)=>s in c?z(c,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[s]=r,U=(c,s)=>{for(var r in s||(s={}))L.call(s,r)&&B(c,r,s[r]);if(M)for(var r of M(s))Q.call(s,r)&&B(c,r,s[r]);return c},F=(c,s)=>A(c,H(s));import{u as D,o as $,c as w,w as a,a as G,b as y,d as t,e as V,E as T,f as j,g as N,h as O,r as g,m as J,i as S,q as R,l as q,a6 as P,ae as X,n as Y,t as Z,j as K,ds as ee,A as le,dr as te,S as ae,c9 as oe,x as ne,Q as se,z as de,C as re,D as ue}from"./index-DKVio5DX.js";import{i as W}from"./index-1zv9CzUI.js";import{i as ie}from"./index-JCBdu9eJ.js";import{i as ce}from"./index-hd5M_H5A.js";import{E as me,a as pe}from"./col-Ru1YGmP5.js";import{u as _e,a as fe,b as ve,l as ge,p as he,r as ye}from"./index-u9YAvNP5.js";import{E as xe}from"./tree-Vw--s94M.js";import{i as be}from"./index-C8m5DZvo.js";const Ve={__name:"role-search",emits:["search"],setup(c,{emit:s}){const r=s,{form:u,resetFields:_}=D({roleName:"",roleCode:"",comments:""}),m=()=>{r("search",u)},f=()=>{_(),m()};return(p,v)=>{const k=T,C=j,x=me,o=N,e=pe,l=O,n=W;return $(),w(n,{"body-style":{paddingBottom:"2px"}},{default:a(()=>[t(l,{"label-width":"72px",onKeyup:G(m,["enter"])},{default:a(()=>[t(e,{gutter:8},{default:a(()=>[t(x,{lg:6,md:8,sm:12,xs:24},{default:a(()=>[t(C,{label:"角色名称"},{default:a(()=>[t(k,{clearable:"",modelValue:y(u).roleName,"onUpdate:modelValue":v[0]||(v[0]=i=>y(u).roleName=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{lg:6,md:8,sm:12,xs:24},{default:a(()=>[t(C,{label:"角色标识"},{default:a(()=>[t(k,{clearable:"",modelValue:y(u).roleCode,"onUpdate:modelValue":v[1]||(v[1]=i=>y(u).roleCode=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{lg:12,md:8,sm:24,xs:24},{default:a(()=>[t(C,{"label-width":"16px"},{default:a(()=>[t(o,{type:"primary",onClick:m},{default:a(()=>[V("查询")]),_:1}),t(o,{onClick:f},{default:a(()=>[V("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ke={__name:"role-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(c,{emit:s}){const r=s,u=c,_=g(!1),m=g(!1),f=g(null),{form:p,resetFields:v,assignFields:k}=D({roleId:void 0,roleName:"",roleCode:"",comments:"",openCheck:""}),C=J({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色标识",type:"string",trigger:"blur"}]}),x=()=>{var e,l;(l=(e=f.value)==null?void 0:e.validate)==null||l.call(e,n=>{if(!n)return;m.value=!0,(_.value?_e:fe)(p).then(h=>{m.value=!1,R.success(h),o(!1),r("done")}).catch(h=>{m.value=!1,R.error(h.message)})})},o=e=>{r("update:modelValue",e)};return S(()=>u.modelValue,e=>{var l,n;e?u.data?(k(u.data),_.value=!0):_.value=!1:(v(),(n=(l=f.value)==null?void 0:l.clearValidate)==null||n.call(l))}),(e,l)=>{const n=T,i=j,h=O,E=N,b=q;return $(),w(b,{form:"",width:460,"model-value":c.modelValue,title:_.value?"修改角色":"添加角色","onUpdate:modelValue":o},{footer:a(()=>[t(E,{onClick:l[3]||(l[3]=d=>o(!1))},{default:a(()=>[V("取消")]),_:1}),t(E,{type:"primary",loading:m.value,onClick:x},{default:a(()=>[V(" 保存 ")]),_:1},8,["loading"])]),default:a(()=>[t(h,{ref_key:"formRef",ref:f,model:y(p),rules:C,"label-width":"80px"},{default:a(()=>[t(i,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(n,{clearable:"",maxlength:20,modelValue:y(p).roleName,"onUpdate:modelValue":l[0]||(l[0]=d=>y(p).roleName=d),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(i,{label:"角色标识",prop:"roleCode"},{default:a(()=>[t(n,{clearable:"",maxlength:20,modelValue:y(p).roleCode,"onUpdate:modelValue":l[1]||(l[1]=d=>y(p).roleCode=d),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),t(i,{label:"备注"},{default:a(()=>[t(n,{rows:4,type:"textarea",modelValue:y(p).comments,"onUpdate:modelValue":l[2]||(l[2]=d=>y(p).comments=d),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Ce={style:{"line-height":"1.1"}},Ee={style:{"vertical-align":"-2px"}},Re={components:ee},Ie=Object.assign(Re,{__name:"role-auth",props:{modelValue:Boolean,data:Object},emits:["update:modelValue"],setup(c,{emit:s}){const r=s,u=c,_=g(null),m=g([]),f=g(!1),p=g(!1),v=g([]),k=()=>{m.value=[],v.value=[],u.data&&(f.value=!0,ge(u.data.roleId).then(o=>{f.value=!1,m.value=te({data:o,idField:"menuId",parentIdField:"parentId"}),ae(()=>{const e=[];oe(m.value,l=>{var n;l.menuId&&l.checked&&!((n=l.children)!=null&&n.length)&&e.push(l.menuId)}),v.value=e})}).catch(o=>{f.value=!1,R.error(o.message)}))},C=()=>{var e,l,n,i,h,E,b,d;p.value=!0;const o=(b=((n=(l=(e=_.value)==null?void 0:e.getCheckedKeys)==null?void 0:l.call(e))!=null?n:[]).concat((E=(h=(i=_.value)==null?void 0:i.getHalfCheckedKeys)==null?void 0:h.call(i))!=null?E:[]))!=null?b:[];ve((d=u.data)==null?void 0:d.roleId,o).then(I=>{p.value=!1,R.success(I),x(!1)}).catch(I=>{p.value=!1,R.error(I.message)})},x=o=>{r("update:modelValue",o)};return S(()=>u.modelValue,o=>{o&&k()}),(o,e)=>{const l=le,n=xe,i=ce,h=N,E=q;return $(),w(E,{width:460,title:"分配权限",position:"center","model-value":c.modelValue,"body-style":{padding:"12px 0 12px 22px"},"onUpdate:modelValue":x},{footer:a(()=>[t(h,{onClick:e[0]||(e[0]=b=>x(!1))},{default:a(()=>[V("取消")]),_:1}),t(h,{type:"primary",loading:p.value,onClick:C},{default:a(()=>[V(" 保存 ")]),_:1},8,["loading"])]),default:a(()=>[t(i,{loading:f.value,style:P({height:"560px",paddingRight:"22px",maxHeight:"calc(100vh - 192px)",minHeight:"100px",overflow:"auto"})},{default:a(()=>[t(n,{ref_key:"treeRef",ref:_,"show-checkbox":"",data:m.value,"node-key":"menuId","default-expand-all":!0,props:{label:"title"},"default-checked-keys":v.value},{default:a(b=>[K("span",Ce,[b.data.icon?($(),w(l,{key:0,size:16,style:{"margin-right":"6px","vertical-align":"-5px"}},{default:a(()=>[($(),w(X(b.data.icon)))]),_:2},1024)):Y("",!0),K("span",Ee,Z(b.data.title),1)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["loading","style"])]),_:1},8,["model-value"])}}}),$e={name:"SystemRole"},je=Object.assign($e,{setup(c){const s=g(null),r=g([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",minWidth:110},{prop:"roleCode",label:"角色标识",minWidth:110},{prop:"comments",label:"备注",minWidth:110},{prop:"createTime",label:"创建时间",minWidth:180},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action"}]),u=g([]),_=g(null),m=g(!1),f=g(!1),p=({page:o,limit:e,where:l,orders:n})=>he(F(U(U({},l),n),{page:o,limit:e})),v=o=>{var e,l;u.value=[],(l=(e=s.value)==null?void 0:e.reload)==null||l.call(e,{page:1,where:o})},k=o=>{_.value=o!=null?o:null,m.value=!0},C=o=>{_.value=o!=null?o:null,f.value=!0},x=o=>{const e=o==null?u.value:[o];if(!e.length){R.error("请至少选择一条数据");return}de.confirm("确定要删除“"+e.map(l=>l.roleName).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const l=R.loading("请求中..");ye(e.map(n=>n.roleId)).then(n=>{l.close(),R.success(n),v()}).catch(n=>{l.close(),R.error(n.message)})}).catch(()=>{})};return(o,e)=>{const l=N,n=re,i=ue,h=ie,E=W,b=be;return $(),w(b,{"hide-footer":"","flex-table":!0},{default:a(()=>[t(Ve,{onSearch:v}),t(E,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":!0},{default:a(()=>[t(h,{ref_key:"tableRef",ref:s,"row-key":"roleId",columns:r.value,datasource:p,"show-overflow-tooltip":!0,selections:u.value,"onUpdate:selections":e[2]||(e[2]=d=>u.value=d),"highlight-current-row":"","cache-key":"systemRoleTable"},{toolbar:a(()=>[t(l,{type:"primary",class:"ele-btn-icon",icon:y(ne),onClick:e[0]||(e[0]=d=>k())},{default:a(()=>[V(" 新建 ")]),_:1},8,["icon"]),t(l,{type:"danger",class:"ele-btn-icon",icon:y(se),onClick:e[1]||(e[1]=d=>x())},{default:a(()=>[V(" 删除 ")]),_:1},8,["icon"])]),action:a(({row:d})=>[t(n,{type:"primary",underline:!1,onClick:I=>k(d)},{default:a(()=>[V(" 修改 ")]),_:2},1032,["onClick"]),t(i,{direction:"vertical"}),t(n,{type:"primary",underline:!1,onClick:I=>C(d)},{default:a(()=>[V(" 分配权限 ")]),_:2},1032,["onClick"]),t(i,{direction:"vertical"}),t(n,{type:"danger",underline:!1,onClick:I=>x(d)},{default:a(()=>[V(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1}),t(ke,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=d=>m.value=d),data:_.value,onDone:v},null,8,["modelValue","data"]),t(Ie,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=d=>f.value=d),data:_.value},null,8,["modelValue","data"])]),_:1})}}});export{je as default};
