var te=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var I=(i,r,c)=>r in i?te(i,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[r]=c,g=(i,r)=>{for(var c in r||(r={}))le.call(r,c)&&I(i,c,r[c]);if(R)for(var c of R(r))ae.call(r,c)&&I(i,c,r[c]);return i},P=(i,r)=>oe(i,se(r));import{u as ne,o as q,c as H,w as e,a as re,b as W,d as s,e as n,E as ce,f as ie,g as L,h as pe,ap as de,v as K,O as ue,P as me,as as fe,r as p,m as _e,t as d,j as f,R as B,x as ye,a6 as D,S as ge,z as O,q as m,at as he,k as be,C as ve,D as xe}from"./index-DKVio5DX.js";import{i as A}from"./index-1zv9CzUI.js";import{i as Te}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{i as ke}from"./index--bFGqZaq.js";import{E as Ce,a as Ee}from"./col-Ru1YGmP5.js";import{p as Se,r as Ne}from"./index--y5nxKK5.js";import{i as we}from"./index-C8m5DZvo.js";const Ue={__name:"search-form",emits:["search"],setup(i,{emit:r}){const c=r,{form:_,resetFields:S}=ne({softName:""}),u=()=>{c("search",_)},h=()=>{S(),u()};return(b,v)=>{const x=ce,y=ie,T=Ce,k=L,C=Ee,N=pe,w=A;return q(),H(w,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[s(N,{"label-width":"72px",onKeyup:re(u,["enter"])},{default:e(()=>[s(C,{gutter:8},{default:e(()=>[s(T,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[s(y,{label:"软件名称"},{default:e(()=>[s(x,{clearable:"",modelValue:W(_).softName,"onUpdate:modelValue":v[0]||(v[0]=E=>W(_).softName=E),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),s(T,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[s(y,{"label-width":"16px"},{default:e(()=>[s(k,{type:"primary",onClick:u},{default:e(()=>[n("查询")]),_:1}),s(k,{onClick:h},{default:e(()=>[n("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},$e={style:{color:"green"}},Pe=f("hr",null,null,-1),Be={style:{color:"red"}},De={name:"ProjectSoft"},Oe=Object.assign(De,{setup(i){const r=de(),c=K(()=>{var l;return(l=r.info)!=null?l:{}}),{push:_}=ue(),{removePageTab:S}=me();fe(["soft_status"]);const u=p(null),h=p(""),b=_e({}),v=K(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"softName",label:"软件名称",minWidth:220,slot:"softName"},{prop:"chargeType",label:"运营模式",minWidth:120,align:"center",slot:"chargeType"},{prop:"softCode",label:"独立识别码",minWidth:180},{prop:"endataType",label:"软件配置",minWidth:270,align:"center",slot:"endataType"},{prop:"regType",label:"注册模式",width:110,align:"center",slot:"regType"},{prop:"softKey",label:"软件秘钥",minWidth:280},{prop:"notice",label:"公告链接",minWidth:200,formatter:l=>window.location.protocol+"//"+window.location.hostname+"/softNotice?s="+l.softCode},{prop:"createTime",label:"创建时间",minWidth:160},{columnKey:"action",label:"操作",width:110,align:"center",showOverflowTooltip:!1,resizable:!1,slot:"action",fixed:"right"}]),x=p([]),y=p(null),T=p(!0),k=p(!1);p(!0);const C=p(!0),N=({page:l,limit:o,where:a,orders:U,filters:$})=>Se(P(g(g(g({},a),U),$),{page:l,limit:o})),w=l=>{Object.assign(b,l),V()},E=l=>{var o,a;(a=(o=u.value)==null?void 0:o.reload)==null||a.call(o,{page:1,where:l})},z=l=>{const o=l?"/project/soft/edit":"/project/soft/add";S({key:o}),ge(()=>{_({path:o,query:l?{id:l.softId}:void 0})})},G=l=>{O.confirm(`确定要删除“${l.softName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const o=m.loading("请求中..");Ne(l.softId).then(a=>{o.close(),m.success(a),V()}).catch(a=>{o.close(),m.error(a.message)})}).catch(()=>{})},V=()=>{h.value?E(P(g({},b),{soft_name:h.value})):E(b)},J=()=>{O.prompt('充值比例：<span style="font-size:13px;"><span style="color:#FBB917">1￥</span>=<span style="color:green">'+F.value+" CPU电量</span></span><br>请输入您需要充值的CPU电量：","充值电量",{inputPattern:/^[\S]{1,18}$/,inputErrorMessage:"电量必须为1-18位非空白字符",customStyle:{"--ele-message-box-body-padding":"4px 20px 0 20px"},draggable:!0,dangerouslyUseHTMLString:!0}).then(({value:l})=>{const o=m.loading("请求中..");he(l).then(a=>{o.close(),m.success(a)}).catch(a=>{o.close(),m.error(a.message)})}).catch(()=>{})},j=p(null),F=p(null);return j.value=c.value.soft_user_usemoney,F.value=c.value.soft_charge,(l,o)=>{const a=be,U=ke,$=L,M=ve,Q=xe,X=Te,Y=A,Z=we;return q(),H(Z,{"flex-table":C.value,style:{"min-height":"600px"}},{default:e(()=>[s(Ue,{onSearch:w}),s(Y,{"body-style":{padding:"10px 10px 10px 10px"},"flex-table":C.value},{default:e(()=>[s(U,{type:"success",closable:!1},{default:e(()=>[n("剩余可用CPU电量："),f("span",$e,[f("u",null,d(c.value.money2),1)]),n(),s(a,{type:"warning",size:"small",effect:"light",onClick:o[0]||(o[0]=B(t=>J(),["stop"])),round:""},{default:e(()=>[n("⚡充电")]),_:1}),Pe,n("软件用户每日登录将会消耗 "),f("span",Be,[f("u",null,d(j.value),1)]),n(" CPU电量 当天多次登录只会消耗一次，不会重复消耗 ")]),_:1}),s(X,{ref_key:"tableRef",ref:u,"row-key":"softId",columns:v.value,datasource:N,current:y.value,"onUpdate:current":o[2]||(o[2]=t=>y.value=t),selections:x.value,"onUpdate:selections":o[3]||(o[3]=t=>x.value=t),"show-overflow-tooltip":!0,"highlight-current-row":"","row-click-checked":"",stripe:k.value,border:T.value,"default-sort":{prop:"createTime",order:"ascending"},pagination:{pageSize:20}},{toolbar:e(()=>[s($,{type:"primary",icon:W(ye),class:"ele-btn-icon",onClick:o[1]||(o[1]=t=>z())},{default:e(()=>[n(" 添加 ")]),_:1},8,["icon"])]),softName:e(({row:t})=>[n(d(t.softName)+" ",1),s(a,{class:"ml-2",size:"small",type:t.softStatus_style,round:""},{default:e(()=>[n(d(t.softStatus),1)]),_:2},1032,["type"])]),chargeType:e(({row:t})=>[s(a,{class:"ml-2",style:D(t.chargeType_style),effect:"dark"},{default:e(()=>[n(d(t.chargeType),1)]),_:2},1032,["style"])]),endataType:e(({row:t})=>[s(a,{class:"ml-2",effect:"plain",style:D(t.loginType_style)},{default:e(()=>[n(d(t.loginType),1)]),_:2},1032,["style"]),n("  "),s(a,{class:"ml-2",effect:"dark",style:D(t.endataType_style)},{default:e(()=>[f("b",null,d(t.endataType),1)]),_:2},1032,["style"]),n("  "),s(a,{class:"ml-2",effect:"plain",type:t.signType_style},{default:e(()=>[n(d(t.signType),1)]),_:2},1032,["type"]),n("  ")]),regType:e(({row:t})=>[s(a,{class:"ml-2",effect:"plain",type:t.regType_style},{default:e(()=>[n(d(t.regType),1)]),_:2},1032,["type"])]),action:e(({row:t})=>[s(M,{type:"primary",underline:!1,onClick:B(ee=>z(t),["stop"])},{default:e(()=>[n(" 修改 ")]),_:2},1032,["onClick"]),s(Q,{direction:"vertical"}),s(M,{type:"danger",underline:!1,onClick:B(ee=>G(t),["stop"])},{default:e(()=>[n(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","current","selections","stripe","border"])]),_:1},8,["flex-table"])]),_:1},8,["flex-table"])}}});export{Oe as default};
