var j=Object.defineProperty,$=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var C=(s,t,n)=>t in s?j(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,E=(s,t)=>{for(var n in t||(t={}))R.call(t,n)&&C(s,n,t[n]);if(B)for(var n of B(t))S.call(t,n)&&C(s,n,t[n]);return s},M=(s,t)=>$(s,P(t));var x=(s,t,n)=>new Promise((r,g)=>{var d=e=>{try{b(n.next(e))}catch(a){g(a)}},h=e=>{try{b(n.throw(e))}catch(a){g(a)}},b=e=>e.done?r(e.value):Promise.resolve(e.value).then(d,h);b((n=n.apply(s,t)).next())});import{u as T,o as U,c as D,w as o,a as q,b as p,d as l,e as _,E as z,f as I,g as K,h as W,s as V,r as F,aq as G,Q as L,t as O,q as u,z as Q,C as A,D as H}from"./index-DKVio5DX.js";import{i as N}from"./index-1zv9CzUI.js";import{i as J}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as X}from"./upload-eKglZPjX.js";import"./progress-5PMSkHEP.js";import{E as Y,a as Z}from"./col-Ru1YGmP5.js";import{i as ee}from"./index-C8m5DZvo.js";const te={__name:"file-search",emits:["search"],setup(s,{emit:t}){const n=t,{form:r,resetFields:g}=T({name:"",path:"",createNickname:""}),d=()=>{n("search",r)},h=()=>{g(),d()};return(b,e)=>{const a=z,i=I,c=Y,y=K,k=Z,w=W,v=N;return U(),D(v,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[l(w,{"label-width":"72px",onKeyup:q(d,["enter"])},{default:o(()=>[l(k,{gutter:8},{default:o(()=>[l(c,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(i,{label:"文件名称"},{default:o(()=>[l(a,{clearable:"",modelValue:p(r).name,"onUpdate:modelValue":e[0]||(e[0]=f=>p(r).name=f),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(i,{label:"文件路径"},{default:o(()=>[l(a,{clearable:"",modelValue:p(r).path,"onUpdate:modelValue":e[1]||(e[1]=f=>p(r).path=f),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(i,{label:"上传人"},{default:o(()=>[l(a,{clearable:"",modelValue:p(r).createNickname,"onUpdate:modelValue":e[2]||(e[2]=f=>p(r).createNickname=f),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(i,{"label-width":"16px"},{default:o(()=>[l(y,{type:"primary",onClick:d},{default:o(()=>[_("查询")]),_:1}),l(y,{onClick:h},{default:o(()=>[_("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};function ae(s,t){return x(this,null,function*(){const n=new FormData;n.append("file",s);const r=yield V.post("/system/file/upload",n,t);return r.data.code===0&&r.data.data?r.data.data:Promise.reject(new Error(r.data.message))})}function le(s){return x(this,null,function*(){const t=yield V.get("/system/file/page",{params:s});return t.data.code===0?t.data.data:Promise.reject(new Error(t.data.message))})}function oe(s){return x(this,null,function*(){const t=yield V.delete("/system/file/remove",{data:s});return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))})}const ne={name:"SystemFile"},ge=Object.assign(ne,{setup(s){const t=F(null),n=F([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名称",sortable:"custom",minWidth:120},{prop:"path",label:"文件路径",sortable:"custom",minWidth:120,slot:"path"},{prop:"length",label:"文件大小",width:120,align:"center",sortable:"custom",formatter:e=>e.length<1024?e.length+"B":e.length<1024*1024?(e.length/1024).toFixed(1)+"KB":e.length<1024*1024*1024?(e.length/1024/1024).toFixed(1)+"M":(e.length/1024/1024/1024).toFixed(1)+"G"},{prop:"createNickname",label:"上传人",width:120,align:"center",sortable:"custom"},{prop:"createTime",label:"上传时间",width:160,align:"center",sortable:"custom"},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action"}]),r=F([]),g=({page:e,limit:a,where:i,orders:c})=>le(M(E(E({},i),c),{page:e,limit:a})),d=e=>{var a,i;r.value=[],(i=(a=t.value)==null?void 0:a.reload)==null||i.call(a,{page:1,where:e})},h=e=>{const a=e==null?r.value:[e];if(!a.length){u.error("请至少选择一条数据");return}Q.confirm("确定要删除“"+a.map(i=>i.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const i=u.loading("请求中..");oe(a.map(c=>c.id)).then(c=>{i.close(),u.success(c),d()}).catch(c=>{i.close(),u.error(c.message)})}).catch(()=>{})},b=e=>{if(e.size/1024/1024>50)return u.error("大小不能超过 50MB"),!1;const a=u.loading({message:"上传中..",mask:!0});return ae(e).then(()=>{a.close(),u.success("上传成功"),d()}).catch(i=>{a.close(),u.error(i.message)}),!1};return(e,a)=>{const i=K,c=X,y=A,k=H,w=J,v=N,f=ee;return U(),D(f,{"hide-footer":"","flex-table":!0},{default:o(()=>[l(te,{onSearch:d}),l(v,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":!0},{default:o(()=>[l(w,{ref_key:"tableRef",ref:t,"row-key":"id",columns:n.value,datasource:g,"show-overflow-tooltip":!0,selections:r.value,"onUpdate:selections":a[1]||(a[1]=m=>r.value=m),"highlight-current-row":"","cache-key":"systemFileTable"},{toolbar:o(()=>[l(c,{action:"","show-upload-list":!1,"before-upload":b,style:{display:"inline-block","vertical-align":"middle"}},{default:o(()=>[l(i,{type:"primary",class:"ele-btn-icon",icon:p(G)},{default:o(()=>[_(" 上传 ")]),_:1},8,["icon"])]),_:1}),l(i,{type:"danger",class:"ele-btn-icon",icon:p(L),style:{"margin-left":"12px"},onClick:a[0]||(a[0]=m=>h())},{default:o(()=>[_(" 删除 ")]),_:1},8,["icon"])]),path:o(({row:m})=>[l(y,{type:"primary",href:m.url,target:"_blank",underline:!1},{default:o(()=>[_(O(m.path),1)]),_:2},1032,["href"])]),action:o(({row:m})=>[l(y,{type:"primary",underline:!1,href:m.downloadUrl,target:"_blank"},{default:o(()=>[_(" 下载 ")]),_:2},1032,["href"]),l(k,{direction:"vertical"}),l(y,{type:"danger",underline:!1,onClick:se=>h(m)},{default:o(()=>[_(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1})]),_:1})}}});export{ge as default};
