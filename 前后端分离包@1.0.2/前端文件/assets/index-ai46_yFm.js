import{a9 as le,cz as te,r as T,v as R,i as w,bs as ae,Z as D,o as ne,c as oe,aF as $,w as B,cc as I,cd as F,af as K,ad as ue,G as ie,d as se,S as v}from"./index-DKVio5DX.js";import{i as re,a as c,v as k}from"./index-oGUME3om.js";import{i as ce}from"./index-JCBdu9eJ.js";const de={modelValue:{type:[String,Number,Boolean,Array],default:()=>null},multiple:Boolean,disabled:Boolean,size:String,clearable:Boolean,placeholder:String,valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},initValue:[Object,Array],cacheData:Array,tableProps:{type:Object,required:!0},maxTagCount:Number,maxTagTextLength:Number,tagType:{type:String,default:"info"},automaticDropdown:Boolean,filterable:Boolean,teleported:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"},transition:{type:String,default:"el-zoom-in-top"},popperOptions:Object,popperClass:String,popperWidth:[Number,String],selectStyle:Object,inputStyle:Object,responsive:{type:Boolean,default:null}},fe={"update:modelValue":e=>!0,change:e=>!0,visibleChange:e=>!0,removeTag:e=>!0,clear:()=>!0,focus:e=>!0,blur:e=>!0,select:e=>!0,filterChange:e=>!0},me=le({name:"EleTableSelect",components:{EleBasicSelect:re,EleProTable:ce},props:de,emits:fe,setup(e,{emit:u}){const y=te(e),f=T(null),r=T(null),C=T(!1),s=T([]),V=R(()=>{const l=s.value;return!e.multiple&&l.length?l[0].label:""}),m=R(()=>{if(!(e.multiple||c(e.modelValue)))return e.modelValue}),P=R(()=>{if(!(!e.multiple||c(e.modelValue)))return e.modelValue}),L=R(()=>{const l=["ele-table-select-popper"];return y.value&&l.push("is-responsive"),e.popperClass&&l.push(e.popperClass),l.join(" ")}),h=()=>{f.value&&f.value.updatePopper()},z=l=>{if(!c(l)){if(e.cacheData!=null){const t=e.cacheData.find(a=>a[e.valueKey]===l);if(t!=null)return t}if(!c(e.initValue))return e.multiple?e.initValue.find(t=>t[e.valueKey]===l):e.initValue}},j=(l,t,a,n,i)=>{if(a!=null){const o=t.indexOf(l);if(o!==-1)return a[o]}if(i!=null){const o=n.indexOf(l);if(o!==-1)return i[o]}},U=()=>{const l=e.modelValue;if(c(l,!0))return[];const t=[],a=[];if(r.value&&(r.value.getSelectionRows()||[]).forEach(i=>{if(!i._isMock){const o=i[e.valueKey],p=l.indexOf(o);p!==-1&&(t.push({value:o,label:i[e.labelKey],index:p}),a.push(o))}}),a.length!==l.length){const{valueKey:n,cacheData:i,initValue:o}=e,p=i?i.map(d=>d[n]):[],x=o?o.map(d=>d[n]):[];l.forEach(d=>{if(!a.includes(d)){const O=j(d,p,i,x,o),_=O?O[e.labelKey]:String(d),ee=l.indexOf(d);t.push({value:d,label:_,index:ee})}})}return t.sort((n,i)=>n.index-i.index),t},b=l=>{if(!e.multiple){const a=e.modelValue,n=s.value.length?s.value[0]:null;if(c(a)){n!=null&&(s.value=[]);return}if(l||!n||n.value!==a){const o=(r.value?r.value.getCurrentRow():null)||z(a),p=o?o[e.labelKey]:String(a);s.value=[{label:p,value:a}]}return}if(c(e.modelValue,!0)){s.value.length&&(s.value=[],v(()=>{h()}));return}const t=s.value.map(a=>a.value);(l||k(e.modelValue,t,!0))&&(s.value=U(),v(()=>{h()}))},W=()=>{f.value&&f.value.focusSearchInput()},E=l=>{const t=e.valueKey;if(!e.multiple){const n=l[t];n===e.modelValue?b():g(n);return}const a=l.map(n=>n[t]);k(e.modelValue,a,!0)?g(a):b()},g=l=>{k(l,e.modelValue,e.multiple)&&(u("update:modelValue",l),u("change",l))},S=l=>{var t;if(C.value!==l){if(C.value=l,l&&((t=e.tableProps)!=null&&t.virtual)&&r.value){const a=r.value.getTableRef();a!=null&&!a.wrapWidth&&v(()=>{a.updateWrapSize(),v(()=>{h()})})}u("visibleChange",l)}},N=l=>{const t=e.modelValue||[];g(t.filter(a=>a!==l.value)),u("removeTag",l.value)},M=()=>{g(e.multiple?[]:null),S(!1),u("clear")},A=l=>{u("focus",l)},q=l=>{u("blur",l)},G=l=>{u("filterChange",l)},Q=l=>{e.multiple&&g(l)},Z=l=>{e.multiple||g(l)},H=(l,t)=>{!e.multiple&&l!=null&&(b(!0),u("select",l)),e.tableProps!=null&&typeof e.tableProps.onCurrentChange=="function"&&e.tableProps.onCurrentChange(l,t)},J=l=>{e.multiple&&(b(!0),u("select",l)),e.tableProps!=null&&typeof e.tableProps.onSelectionChange=="function"&&e.tableProps.onSelectionChange(l)},X=(l,t,a)=>{e.multiple||S(!1),e.tableProps!=null&&typeof e.tableProps.onRowClick=="function"&&e.tableProps.onRowClick(l,t,a)},Y=(l,t)=>{v(()=>{h()}),e.tableProps!=null&&typeof e.tableProps.onDone=="function"&&e.tableProps.onDone(l,t)};return w(()=>e.modelValue,()=>{b()},{deep:!0}),w(()=>e.cacheData,()=>{b(!0)}),w(()=>e.initValue,l=>{c(l)||E(l)},{deep:!0}),w(()=>e.disabled,l=>{l&&S(!1)}),ae(()=>{c(e.initValue,e.multiple)?c(e.modelValue,e.multiple)||b():E(e.initValue)}),{selectRef:f,tableRef:r,selectVisible:C,selectedItems:s,selectedLabel:V,currentRowKey:m,selectedRowKeys:P,selectPopperClass:L,updatePopover:h,updateSelectedItems:b,focusSearchInput:W,updateVisible:S,onSelectRemove:N,onSelectClear:M,onSelectFocus:A,onSelectBlur:q,onSelectFilter:G,updateSelectedRowKeys:Q,updateCurrentRowKey:Z,onTableCurrentChange:H,onTableSelectionChange:J,onTableRowClick:X,onTableDone:Y}}}),be=(e,u)=>{const y=e.__vccOpts||e;for(const[f,r]of u)y[f]=r;return y};function ge(e,u,y,f,r,C){const s=D("EleProTable"),V=D("EleBasicSelect");return ne(),oe(V,{ref:"selectRef",value:e.modelValue,multiple:e.multiple,disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,maxTagCount:e.maxTagCount,maxTagTextLength:e.maxTagTextLength,tagType:e.tagType,automaticDropdown:e.automaticDropdown,filterable:e.filterable,teleported:e.teleported,persistent:e.persistent,placement:e.placement,transition:e.transition,popperWidth:e.popperWidth,popperOptions:e.popperOptions,popperClass:e.selectPopperClass,selectStyle:e.selectStyle,inputStyle:e.inputStyle,selectedLabel:e.selectedLabel,selected:e.selectedItems,visible:e.selectVisible,"onUpdate:visible":e.updateVisible,onFilterChange:e.onSelectFilter,onRemoveTag:e.onSelectRemove,onClear:e.onSelectClear,onFocus:e.onSelectFocus,onBlur:e.onSelectBlur},$({default:B(()=>[K(e.$slots,"topExtra"),se(s,ue(e.tableProps||{},{ref:"tableRef",rowKey:e.valueKey,reserveCurrent:!0,highlightCurrentRow:!e.multiple,currentRowKey:e.currentRowKey,selectedRowKeys:e.selectedRowKeys,"onUpdate:selectedRowKeys":e.updateSelectedRowKeys,"onUpdate:currentRowKey":e.updateCurrentRowKey,onSelectionChange:e.onTableSelectionChange,onCurrentChange:e.onTableCurrentChange,onRowClick:e.onTableRowClick,onDone:e.onTableDone}),$({_:2},[ie(Object.keys(e.$slots).filter(m=>!["topExtra","bottomExtra","maxTagPlaceholder"].includes(m)),m=>({name:m,fn:B(P=>[K(e.$slots,m,F(I(P||{})))])}))]),1040,["rowKey","highlightCurrentRow","currentRowKey","selectedRowKeys","onUpdate:selectedRowKeys","onUpdate:currentRowKey","onSelectionChange","onCurrentChange","onRowClick","onDone"]),K(e.$slots,"bottomExtra")]),_:2},[e.$slots.maxTagPlaceholder?{name:"maxTagPlaceholder",fn:B(m=>[K(e.$slots,"maxTagPlaceholder",F(I(m||{})))]),key:"0"}:void 0]),1032,["value","multiple","disabled","size","clearable","placeholder","maxTagCount","maxTagTextLength","tagType","automaticDropdown","filterable","teleported","persistent","placement","transition","popperWidth","popperOptions","popperClass","selectStyle","inputStyle","selectedLabel","selected","visible","onUpdate:visible","onFilterChange","onRemoveTag","onClear","onFocus","onBlur"])}const ve=be(me,[["render",ge]]);export{ve as i};
