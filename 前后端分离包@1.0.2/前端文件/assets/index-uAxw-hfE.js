var q=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var B=(i,l,n)=>l in i?q(i,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[l]=n,T=(i,l)=>{for(var n in l||(l={}))J.call(l,n)&&B(i,n,l[n]);if(A)for(var n of A(l))X.call(l,n)&&B(i,n,l[n]);return i},O=(i,l)=>G(i,Q(l));var M=(i,l,n)=>new Promise((f,g)=>{var x=d=>{try{k(n.next(d))}catch(_){g(_)}},a=d=>{try{k(n.throw(d))}catch(_){g(_)}},k=d=>d.done?f(d.value):Promise.resolve(d.value).then(x,a);k((n=n.apply(i,l)).next())});import{r as m,u as R,o as D,c as $,w as e,a as Y,b as c,F as Z,G as ee,p as te,d as t,e as r,a7 as le,a8 as ae,f as oe,g as z,h as ne,s as W,i as se,t as p,l as re,O as ie,P as ce,m as de,v as ue,Q as pe,a6 as me,R as P,q as F,z as fe,k as _e,C as ge,D as be}from"./index-DKVio5DX.js";import{i as j}from"./index-1zv9CzUI.js";import{i as ve}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as he,a as ye}from"./col-Ru1YGmP5.js";import{l as xe}from"./index--y5nxKK5.js";import{E as ke,a as Ee}from"./descriptions-item-KgQ7D8Go.js";import{i as we}from"./index-C8m5DZvo.js";const Ie={__name:"search-form",emits:["search"],setup(i,{emit:l}){const n=l,f=m([]);xe().then(d=>{f.value=d}).catch(d=>{EleMessage.error(d.message)});const{form:g,resetFields:x}=R({softId:""}),a=()=>{n("search",g)},k=()=>{x(),a()};return(d,_)=>{const y=le,b=ae,s=oe,E=he,I=z,V=ye,C=ne,u=j;return D(),$(u,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(C,{"label-width":"72px",onKeyup:Y(a,["enter"])},{default:e(()=>[t(V,{gutter:8},{default:e(()=>[t(E,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(s,{label:"软件名称",prop:"softId"},{default:e(()=>[t(b,{clearable:"",modelValue:c(g).softId,"onUpdate:modelValue":_[0]||(_[0]=o=>c(g).softId=o),placeholder:"不限",class:"ele-fluid"},{default:e(()=>[(D(!0),te(Z,null,ee(f.value,o=>(D(),$(y,{key:o.softId,value:o.softId,label:o.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(E,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(s,{"label-width":"16px"},{default:e(()=>[t(I,{type:"primary",onClick:a},{default:e(()=>[r("查询")]),_:1}),t(I,{onClick:k},{default:e(()=>[r("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};function Ve(i){return M(this,null,function*(){const l=yield W.get("/soft/online/page",{params:i});return l.data.code===0?l.data.data:Promise.reject(new Error(l.data.message))})}function Te(i){return M(this,null,function*(){const l=yield W.delete("/soft/online/remove",{data:i});return l.data.code===0?l.data.message:Promise.reject(new Error(l.data.message))})}const De={__name:"cookie-info",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(i,{emit:l}){const n=l,f=i,g=m(!1);m(!1);const x=m(null),{form:a,resetFields:k,assignFields:d}=R({cookieId:void 0,softId:"",userId:"",softName:"",userAccount:"",userEndtime:"",userPoint:"",softVersion:"",loginType:"",loginType_style:"",loginCookie:"",loginFeature:"",loginIp:"",loginMac:"",clientID:"",clientOS:"",createTime:"",updateTime:""}),_=y=>{n("update:modelValue",y)};return se(()=>f.modelValue,y=>{var b,s;y?f.data?(d(O(T({},f.data),{password:""})),g.value=!0):g.value=!1:(k(),(s=(b=x.value)==null?void 0:b.clearValidate)==null||s.call(b))}),(y,b)=>{const s=ke,E=Ee,I=z,V=re;return D(),$(V,{form:"",style:{"word-break":"break-all"},width:640,"model-value":i.modelValue,title:"在线详情","onUpdate:modelValue":_},{footer:e(()=>[t(I,{onClick:b[0]||(b[0]=C=>_(!1))},{default:e(()=>[r("关闭")]),_:1})]),default:e(()=>[t(E,{class:"margin-top",column:"2",size:"small",border:""},{default:e(()=>[t(s,{label:c(a).loginType,align:"center",span:2},{default:e(()=>[r(p(c(a).userAccount),1)]),_:1},8,["label"]),t(s,{label:"登录软件",align:"center"},{default:e(()=>[r(p(c(a).softName),1)]),_:1}),t(s,{label:"软件版本",align:"center"},{default:e(()=>[r(p(c(a).softVersion),1)]),_:1}),t(s,{label:"到期时间",align:"center"},{default:e(()=>[r(p(c(a).userEndtime),1)]),_:1}),t(s,{label:"点数余额",align:"center"},{default:e(()=>[r(p(c(a).userPoint),1)]),_:1}),t(s,{label:"登录凭据",align:"center",span:2},{default:e(()=>[r(p(c(a).loginCookie),1)]),_:1}),t(s,{label:"登录特征",align:"center",span:2},{default:e(()=>[r(p(c(a).loginFeature),1)]),_:1}),t(s,{label:"登录时间",align:"center",span:2},{default:e(()=>[r(p(c(a).createTime),1)]),_:1}),t(s,{label:"心跳时间",align:"center",span:2},{default:e(()=>[r(p(c(a).updateTime),1)]),_:1}),t(s,{label:"IP地址",align:"center",span:2},{default:e(()=>[r(p(c(a).loginIp),1)]),_:1}),t(s,{label:"MAC码",align:"center",span:2},{default:e(()=>[r(p(c(a).loginMac),1)]),_:1}),t(s,{label:"客户端OS",align:"center",span:2},{default:e(()=>[r(p(c(a).clientOS),1)]),_:1}),t(s,{label:"客户端ID",align:"center",span:2},{default:e(()=>[r(p(c(a).clientID),1)]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ce={name:"SoftOnline"},Re=Object.assign(Ce,{setup(i){ie(),ce();const l=m(null),n=m(""),f=de({}),g=ue(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"userAccount",label:"账号",minWidth:200,slot:"userAccount"},{prop:"softName",label:"所属软件",minWidth:160},{prop:"softVersion",label:"登录版本",width:100,align:"center"},{prop:"createTime",label:"登录时间",minWidth:160,align:"center"},{prop:"updateTime",label:"心跳时间",minWidth:160,align:"center"},{prop:"clientID",label:"客户端ID",minWidth:200},,{prop:"clientOS",label:"客户端OS",minWidth:160},{columnKey:"action",label:"操作",width:130,align:"center",showOverflowTooltip:!1,resizable:!1,slot:"action",fixed:"right"}]),x=m([]),a=m(null),k=m(!0),d=m(!1);m(!0);const _=m(!0),y=m(!1),b=({page:u,limit:o,where:v,orders:w,filters:S})=>Ve(O(T(T(T({},v),w),S),{page:u,limit:o})),s=u=>{Object.assign(f,u),C()},E=u=>{var o,v;(v=(o=l.value)==null?void 0:o.reload)==null||v.call(o,{page:1,where:u})},I=u=>{a.value=u!=null?u:null,y.value=!0},V=u=>{const o=u==null?x.value:[u];if(!o.length){F.error("请至少选择一条数据");return}fe.confirm("确定要离线用户“"+o.map(v=>v.userAccount).join(", ")+'”吗?<br><b style="font-size: 12px;color:red">强制离线后客户端将在下次和服务端通讯时失败</b>',"系统提示",{dangerouslyUseHTMLString:!0,type:"warning",draggable:!0}).then(()=>{const v=F.loading("请求中..");Te(o.map(w=>w.cookieId)).then(w=>{v.close(),F.success(w),E()}).catch(w=>{v.close(),F.error(w.message)})}).catch(()=>{})},C=()=>{n.value?E(O(T({},f),{soft_name:n.value})):E(f)};return(u,o)=>{const v=z,w=_e,S=ge,N=be,U=ve,K=j,L=we;return D(),$(L,{"hide-footer":"","flex-table":_.value,style:{"min-height":"600px"}},{default:e(()=>[t(Ie,{onSearch:s}),t(K,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":_.value},{default:e(()=>[t(U,{ref_key:"tableRef",ref:l,"row-key":"cookieId",columns:g.value,datasource:b,selections:x.value,"onUpdate:selections":o[1]||(o[1]=h=>x.value=h),"show-overflow-tooltip":!0,"highlight-current-row":"","row-click-checked":"",stripe:d.value,border:k.value,"default-sort":{prop:"createTime",order:"ascending"},size:"small",pagination:{pageSize:20}},{toolbar:e(()=>[t(v,{type:"danger",class:"ele-btn-icon",icon:c(pe),onClick:o[0]||(o[0]=h=>V())},{default:e(()=>[r(" 离线 ")]),_:1},8,["icon"])]),userAccount:e(({row:h})=>[t(w,{class:"mx-1",style:me(h.loginType_style),effect:"dark",size:"small"},{default:e(()=>[r(p(h.loginType),1)]),_:2},1032,["style"]),r(" "+p(h.userAccount),1)]),action:e(({row:h})=>[t(S,{type:"primary",underline:!1,onClick:P(H=>I(h),["stop"])},{default:e(()=>[r(" 查看 ")]),_:2},1032,["onClick"]),t(N,{direction:"vertical"}),t(S,{type:"danger",underline:!1,onClick:P(H=>V(h),["stop"])},{default:e(()=>[r(" 离线 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections","stripe","border"])]),_:1},8,["flex-table"]),t(De,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=h=>y.value=h),data:a.value,onDone:E},null,8,["modelValue","data"])]),_:1},8,["flex-table"])}}});export{Re as default};
