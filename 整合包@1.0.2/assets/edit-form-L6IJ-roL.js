var ae=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var M=(d,r,m)=>r in d?ae(d,r,{enumerable:!0,configurable:!0,writable:!0,value:m}):d[r]=m,k=(d,r)=>{for(var m in r||(r={}))ne.call(r,m)&&M(d,m,r[m]);if(R)for(var m of R(r))re.call(r,m)&&M(d,m,r[m]);return d},N=(d,r)=>oe(d,se(r));import{_ as T,u as j,o as E,c as D,w as l,b as o,d as e,e as I,E as z,f as q,g as G,h as $,O as de,P as ue,r as b,m as B,i as me,F as ie,G as pe,p as ce,q as O,a7 as fe,a8 as _e,W as ge,M as be,N as he,j as xe}from"./index-DKVio5DX.js";import{E as H,a as K}from"./col-Ru1YGmP5.js";import"./index-oGUME3om.js";import"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{i as ve}from"./index-ai46_yFm.js";import{E as Ve}from"./alert-GJy0wCuj.js";import{i as we}from"./index-1zv9CzUI.js";import{B as ye}from"./index-bSvVF2vt.js";import{z as ke,a as Ee}from"./zh_Hans-LNKypXxg.js";import{g as Ie,h as Fe}from"./github-markdown-light--sWw-Hw4.js";import{u as Ue,p as Se}from"./index-94H0BTDC.js";import{u as Ce,a as Be}from"./index-ZlDGKLQ8.js";import{l as De}from"./index--y5nxKK5.js";const Pe={__name:"file-search",emits:["search"],setup(d,{emit:r}){const m=r,{form:h,resetFields:x}=j({name:""}),v=()=>{m("search",h)},F=()=>{x(),v()};return(U,V)=>{const S=z,_=q,f=H,g=G,w=K,s=$;return E(),D(s,{"label-width":"60px",size:"small",class:"demo-search"},{default:l(()=>[e(w,null,{default:l(()=>[e(f,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(_,{label:"文件名"},{default:l(()=>[e(S,{clearable:"",modelValue:o(h).name,"onUpdate:modelValue":V[0]||(V[0]=C=>o(h).name=C),modelModifiers:{trim:!0},placeholder:`请输入
`},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(_,{"label-width":"12px"},{default:l(()=>[e(g,{type:"primary",onClick:v},{default:l(()=>[I("查询")]),_:1}),e(g,{onClick:F},{default:l(()=>[I("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Re=T(Pe,[["__scopeId","data-v-38504646"]]),Me=d=>(be("data-v-7a29cd4b"),d=d(),he(),d),Ne=Me(()=>xe("br",null,null,-1)),Oe={__name:"edit-form",props:{data:Object},setup(d){const r=d,{currentRoute:m,push:h}=de(),{removePageTab:x,reloadPageTab:v}=ue();b(null);const F=B({locale:ke,plugins:[Ie({locale:Ee}),Fe()],editorConfig:{lineNumbers:!0},uploadImages:t=>Promise.all(t.map(a=>new Promise((i,u)=>{Ue(a).then(c=>{const p={url:c.url,alt:c.name,title:c.name};i(p)}).catch(c=>{u(c)})})))}),U=b(null),V=B({datasource:({page:t,limit:a,where:i,orders:u})=>Se(N(k(k({},i),u),{page:t,limit:a})),columns:[{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名",minwidth:180},{prop:"length",label:"文件大小",align:"center",minwidth:120,formatter:t=>t.length<1024?t.length+"B":t.length<1024*1024?(t.length/1024).toFixed(1)+"KB":t.length<1024*1024*1024?(t.length/1024/1024).toFixed(1)+"M":(t.length/1024/1024/1024).toFixed(1)+"G"},{prop:"downloadUrl",label:"下载地址",minwidth:120},{prop:"createTime",label:"上传时间",minwidth:80}],showOverflowTooltip:!0,toolbar:!1,pagination:{pageSize:6,layout:"total, prev, pager, next, jumper",style:{padding:"0px"}},rowClickChecked:!0}),S=t=>{var a,i,u;(u=(i=(a=U.value)==null?void 0:a.tableRef)==null?void 0:i.reload)==null||u.call(i,{where:t,page:1})},_=b(!1),f=b(!1),g=b(null),w=b([]);De().then(t=>{w.value=t});const{form:s,resetFields:C,assignFields:A}=j({versionId:void 0,version:"",md5:"",url:"",log:"",nversion:"",gxfs:void 0,softId:void 0}),L=B({version:[{required:!0,message:"请输入发布版号",type:"string",trigger:"blur"}],gxfs:[{required:!0,message:"请选择更新方式",type:"string",trigger:"blur"}],softId:[{required:!0,message:"请选择公告所属软件",type:"number",trigger:"blur"}]}),W=()=>{var t,a;(a=(t=g.value)==null?void 0:t.validate)==null||a.call(t,i=>{if(!i)return;f.value=!0,(_.value?Ce:Be)(s).then(c=>{f.value=!1,O.success(c),Q()}).catch(c=>{f.value=!1,O.error(c.message)})})},J=()=>{x({key:o(m).path}),h("/project/edition")},Q=()=>{x({key:o(m).path}),v({fullPath:"/project/edition"})};return me(()=>r.data,()=>{var t,a;r.data?(A(k({},r.data)),_.value=!0):(_.value=!1,C(),(a=(t=g.value)==null?void 0:t.clearValidate)==null||a.call(t))},{immediate:!0}),(t,a)=>{const i=G,u=q,c=we,p=H,X=fe,Y=_e,y=z,Z=ge,ee=Ve,le=ve,P=K,te=$;return E(),D(te,{ref_key:"formRef",ref:g,model:o(s),rules:L,"label-width":"80px"},{default:l(()=>[e(P,{gutter:10},{default:l(()=>[e(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[e(c,null,{default:l(()=>[e(u,{style:{"margin-left":"-90px","margin-top":"-10px","margin-block":"-10px"}},{default:l(()=>[e(i,{type:"primary",loading:f.value,onClick:W},{default:l(()=>[I(" 保存 ")]),_:1},8,["loading"]),e(i,{onClick:J},{default:l(()=>[I("关闭")]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[e(c,null,{default:l(()=>[e(P,{gutter:16},{default:l(()=>[e(p,{lg:24,md:24,sm:24,xs:24},{default:l(()=>[e(u,{label:"所属软件",prop:"softId"},{default:l(()=>[e(Y,{clearable:"",modelValue:o(s).softId,"onUpdate:modelValue":a[0]||(a[0]=n=>o(s).softId=n),placeholder:"请选择版本所属软件",class:"ele-fluid"},{default:l(()=>[(E(!0),ce(ie,null,pe(w.value,n=>(E(),D(X,{key:n.softId,value:n.softId,label:n.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:12,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"发布版号",prop:"version"},{default:l(()=>[e(y,{clearable:"",maxlength:50,modelValue:o(s).version,"onUpdate:modelValue":a[1]||(a[1]=n=>o(s).version=n),"show-word-limit":"",placeholder:"请输入发布版号"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:12,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"更新方式",prop:"gxfs"},{default:l(()=>[e(Z,{code:"soft_gxfs",modelValue:o(s).gxfs,"onUpdate:modelValue":a[2]||(a[2]=n=>o(s).gxfs=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:12,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"软件MD5",prop:"md5"},{default:l(()=>[e(y,{clearable:"",maxlength:50,modelValue:o(s).md5,"onUpdate:modelValue":a[3]||(a[3]=n=>o(s).md5=n),"show-word-limit":"",placeholder:"请输入软件MD5(开启软件摘要验证时必填)"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:12,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"旧版本号",prop:"nversion"},{default:l(()=>[e(y,{clearable:"",maxlength:50,modelValue:o(s).nversion,"onUpdate:modelValue":a[4]||(a[4]=n=>o(s).nversion=n),"show-word-limit":"",placeholder:"更新到发布版本的旧版本号"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:24,md:24,sm:24,xs:24},{default:l(()=>[e(ee,{title:"下载链接可手动输入或选择已经上传的附件后自动填写下载链接",type:"success",closable:!1}),Ne]),_:1}),e(p,{lg:24,md:24,sm:24,xs:24},{default:l(()=>[e(u,{label:"下载链接",prop:"url"},{default:l(()=>[e(y,{clearable:"",maxlength:200,modelValue:o(s).url,"onUpdate:modelValue":a[5]||(a[5]=n=>o(s).url=n),"show-word-limit":"",placeholder:"新版软件包下载链接"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{lg:24,md:24,sm:24,xs:24},{default:l(()=>[e(u,{label:"附件选择",prop:"url"},{default:l(()=>[e(le,{ref_key:"selectRef",ref:U,clearable:"",placeholder:"选择已上传的新版软件包","value-key":"downloadUrl","label-key":"downloadUrl",modelValue:o(s).url,"onUpdate:modelValue":a[6]||(a[6]=n=>o(s).url=n),"table-props":V,"popper-width":580,disabled:t.disabled,"init-value":t.initValue,onSelect:t.onSelect},{default:l(()=>[e(Re,{onSearch:S})]),_:1},8,["modelValue","table-props","disabled","init-value","onSelect"])]),_:1})]),_:1}),e(p,{lg:24,md:24,sm:24,xs:24},{default:l(()=>[e(ye,{modelValue:o(s).log,"onUpdate:modelValue":a[7]||(a[7]=n=>o(s).log=n),config:F,height:"600px"},null,8,["modelValue","config"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}},Ze=T(Oe,[["__scopeId","data-v-7a29cd4b"]]);export{Ze as E};
