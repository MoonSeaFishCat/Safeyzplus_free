var L=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var R=(c,l,n)=>l in c?L(c,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[l]=n,y=(c,l)=>{for(var n in l||(l={}))Q.call(l,n)&&R(c,n,l[n]);if(N)for(var n of N(l))A.call(l,n)&&R(c,n,l[n]);return c},B=(c,l)=>G(c,H(l));import{r as u,u as J,o as m,c as g,w as e,a as X,b as F,F as Y,G as Z,p as ee,d as s,e as d,a7 as te,a8 as oe,f as se,g as S,h as le,O as ne,P as ae,m as re,v as ce,x as ie,Q as de,t as ue,n as W,R as O,S as pe,q as $,z as me,k as fe,C as _e,D as ge}from"./index-DKVio5DX.js";import{i as K}from"./index-1zv9CzUI.js";import{i as ve}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as be,a as he}from"./col-Ru1YGmP5.js";import{l as xe}from"./index--y5nxKK5.js";import{p as ye,r as ke}from"./index-ZlDGKLQ8.js";import{i as Ee}from"./index-C8m5DZvo.js";const we={__name:"search-form",emits:["search"],setup(c,{emit:l}){const n=l,v=u([]);xe().then(p=>{v.value=p}).catch(p=>{EleMessage.error(p.message)});const{form:f,resetFields:b}=J({softId:""}),h=()=>{n("search",f)},x=()=>{b(),h()};return(p,k)=>{const V=te,E=oe,w=se,C=be,_=S,I=he,D=le,j=K;return m(),g(j,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[s(D,{"label-width":"72px",onKeyup:X(h,["enter"])},{default:e(()=>[s(I,{gutter:8},{default:e(()=>[s(C,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[s(w,{label:"软件名称",prop:"softId"},{default:e(()=>[s(E,{clearable:"",modelValue:F(f).softId,"onUpdate:modelValue":k[0]||(k[0]=o=>F(f).softId=o),placeholder:"不限",class:"ele-fluid"},{default:e(()=>[(m(!0),ee(Y,null,Z(v.value,o=>(m(),g(V,{key:o.softId,value:o.softId,label:o.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(C,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[s(w,{"label-width":"16px"},{default:e(()=>[s(_,{type:"primary",onClick:h},{default:e(()=>[d("查询")]),_:1}),s(_,{onClick:x},{default:e(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Ce={name:"ProjectEdition"},Re=Object.assign(Ce,{setup(c){const{push:l}=ne(),{removePageTab:n}=ae(),v=u(null),f=u(""),b=re({}),h=ce(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"softName",label:"软件名称",minWidth:200},{prop:"version",label:"发布版号",minWidth:100},{prop:"nversion",label:"旧版本号",minWidth:100,slot:"nversion"},{prop:"gxfs",label:"更新方式",width:110,align:"center",slot:"gxfs"},{prop:"md5",label:"版本摘要",minWidth:180},{prop:"createTime",label:"发布时间",minWidth:180},{columnKey:"action",label:"操作",width:130,align:"center",showOverflowTooltip:!1,resizable:!1,slot:"action",fixed:"right"}]),x=u([]),p=u(null),k=u(!0),V=u(!1);u(!0);const E=u(!0),w=({page:o,limit:t,where:r,orders:i,filters:T})=>ye(B(y(y(y({},r),i),T),{page:o,limit:t})),C=o=>{Object.assign(b,o),j()},_=o=>{var t,r;(r=(t=v.value)==null?void 0:t.reload)==null||r.call(t,{page:1,where:o})},I=o=>{const t=o?"/project/edition/edit":"/project/edition/add";n({key:t}),pe(()=>{l({path:t,query:o?{id:o.versionId}:void 0})})},D=o=>{const t=o==null?x.value:[o];if(!t.length){$.error("请至少选择一条数据");return}me.confirm("确定要删除“"+t.map(r=>r.softName+"["+r.version+"]").join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const r=$.loading("请求中..");ke(t.map(i=>i.versionId)).then(i=>{r.close(),$.success(i),_()}).catch(i=>{r.close(),$.error(i.message)})}).catch(()=>{})},j=()=>{f.value?_(B(y({},b),{soft_name:f.value})):_(b)};return(o,t)=>{const r=S,i=fe,T=_e,M=ge,P=ve,U=K,q=Ee;return m(),g(q,{"hide-footer":"","flex-table":E.value,style:{"min-height":"600px"}},{default:e(()=>[s(we,{onSearch:C}),s(U,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":E.value},{default:e(()=>[s(P,{ref_key:"tableRef",ref:v,"row-key":"versionId",columns:h.value,datasource:w,current:p.value,"onUpdate:current":t[2]||(t[2]=a=>p.value=a),selections:x.value,"onUpdate:selections":t[3]||(t[3]=a=>x.value=a),"show-overflow-tooltip":!0,"highlight-current-row":"","row-click-checked":"",stripe:V.value,border:k.value,"default-sort":{prop:"createTime",order:"ascending"}},{toolbar:e(()=>[s(r,{type:"primary",icon:F(ie),class:"ele-btn-icon",onClick:t[0]||(t[0]=a=>I())},{default:e(()=>[d(" 添加 ")]),_:1},8,["icon"]),s(r,{type:"danger",class:"ele-btn-icon",icon:F(de),onClick:t[1]||(t[1]=a=>D())},{default:e(()=>[d(" 删除 ")]),_:1},8,["icon"])]),nversion:e(({row:a})=>[a.nversion!==""?(m(),g(i,{key:0,class:"ml-2"},{default:e(()=>[d(ue(a.nversion),1)]),_:2},1024)):W("",!0),d("  ")]),gxfs:e(({row:a})=>[a.gxfs===1?(m(),g(i,{key:0,class:"ml-2",type:"danger"},{default:e(()=>[d("强制更新")]),_:1})):a.gxfs===0?(m(),g(i,{key:1,class:"ml-2",type:"success"},{default:e(()=>[d("自选更新")]),_:1})):W("",!0),d("  ")]),action:e(({row:a})=>[s(T,{type:"primary",underline:!1,onClick:O(z=>I(a),["stop"])},{default:e(()=>[d(" 修改 ")]),_:2},1032,["onClick"]),s(M,{direction:"vertical"}),s(T,{type:"danger",underline:!1,onClick:O(z=>D(a),["stop"])},{default:e(()=>[d(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","current","selections","stripe","border"])]),_:1},8,["flex-table"])]),_:1},8,["flex-table"])}}});export{Re as default};
