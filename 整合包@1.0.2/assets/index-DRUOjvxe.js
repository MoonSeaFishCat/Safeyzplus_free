var re=Object.defineProperty,se=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var J=(i,a,d)=>a in i?re(i,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):i[a]=d,I=(i,a)=>{for(var d in a||(a={}))ce.call(a,d)&&J(i,d,a[d]);if(G)for(var d of G(a))me.call(a,d)&&J(i,d,a[d]);return i},F=(i,a)=>se(i,ie(a));var U=(i,a,d)=>new Promise((_,k)=>{var V=v=>{try{E(d.next(v))}catch(x){k(x)}},l=v=>{try{E(d.throw(v))}catch(x){k(x)}},E=v=>v.done?_(v.value):Promise.resolve(v.value).then(V,l);E((d=d.apply(i,a)).next())});import{u as z,o as T,c as B,w as e,a as de,b as n,d as t,e as s,E as K,f as H,g as D,h as L,r as w,i as X,t as p,j as Y,k as Z,l as ee,_ as ue,s as S,m as pe,n as Q,p as _e,q as y,v as fe,x as ge,y as be,z as O,A as he,B as ve,C as ye,D as xe}from"./index-DKVio5DX.js";import{i as te}from"./index-1zv9CzUI.js";import{i as we}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as A,a as q}from"./col-Ru1YGmP5.js";import{E as ae,a as le}from"./descriptions-item-KgQ7D8Go.js";import"./index-oGUME3om.js";import{i as ke}from"./index-ai46_yFm.js";import{i as Ve}from"./index-C8m5DZvo.js";const Ne={__name:"search-form",emits:["search"],setup(i,{emit:a}){const d=a,{form:_,resetFields:k}=z({softName:""}),V=()=>{d("search",_)},l=()=>{k(),V()};return(E,v)=>{const x=K,N=H,h=A,c=D,g=q,u=L,o=te;return T(),B(o,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(u,{"label-width":"72px",onKeyup:de(V,["enter"])},{default:e(()=>[t(g,{gutter:8},{default:e(()=>[t(h,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(N,{label:"软件名称"},{default:e(()=>[t(x,{clearable:"",modelValue:n(_).softName,"onUpdate:modelValue":v[0]||(v[0]=m=>n(_).softName=m),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(N,{"label-width":"16px"},{default:e(()=>[t(c,{type:"primary",onClick:V},{default:e(()=>[s("查询")]),_:1}),t(c,{onClick:l},{default:e(()=>[s("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Ce=Y("br",null,null,-1),Ee={__name:"carmi-info",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(i,{emit:a}){const d=a,_=i,k=w(!1);w(!1);const V=w(null),{form:l,resetFields:E,assignFields:v}=z({carmiId:void 0,softId:"",softName:"",carmiStatus:"",carmiStatus_style:"",carmiStr:"",carmiName:"",carmiTime:"",carmiPoint:"",carmiOpening:"",carmiBind:"",carmiUnbind:"",carmiNotes:"",makingUser:"",makingMoney:"",useUser:"",useTime:"",createTime:"",updateTime:"",carmiPch:""}),x=N=>{d("update:modelValue",N)};return X(()=>_.modelValue,N=>{var h,c;N?_.data?(v(F(I({},_.data),{password:""})),k.value=!0):k.value=!1:(E(),(c=(h=V.value)==null?void 0:h.clearValidate)==null||c.call(h))}),(N,h)=>{const c=ae,g=Z,u=le,o=D,m=ee;return T(),B(m,{form:"",width:640,"model-value":i.modelValue,title:"充值卡详情","onUpdate:modelValue":x},{footer:e(()=>[t(o,{onClick:h[0]||(h[0]=r=>x(!1))},{default:e(()=>[s("关闭")]),_:1})]),default:e(()=>[t(u,{class:"margin-top",column:"2",size:"small",border:""},{default:e(()=>[t(c,{label:"充值卡号",align:"center",span:2},{default:e(()=>[s(p(n(l).carmiStr),1)]),_:1}),t(c,{label:"所属软件",align:"center",span:2},{default:e(()=>[s(p(n(l).softName),1)]),_:1}),t(c,{label:"充值卡名",align:"center"},{default:e(()=>[s(p(n(l).carmiName),1)]),_:1}),t(c,{label:"使用状态",align:"center"},{default:e(()=>[t(g,{class:"ml-2",size:"small",type:n(l).carmiStatus_style},{default:e(()=>[s(p(n(l).carmiStatus),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"充值时间",align:"center",span:2},{default:e(()=>[s(p(n(l).carmiTime)+" 分钟（"+p((n(l).carmiTime/1440).toFixed(2))+"天）",1)]),_:1}),t(c,{label:"充值点数",align:"center"},{default:e(()=>[s(p(n(l).carmiPoint),1)]),_:1}),t(c,{label:"通道数量",align:"center"},{default:e(()=>[s(p(n(l).carmiOpening),1)]),_:1}),t(c,{label:"绑定数量",align:"center"},{default:e(()=>[s(p(n(l).carmiBind),1)]),_:1}),t(c,{label:"解绑次数",align:"center"},{default:e(()=>[s(p(n(l).carmiUnbind),1)]),_:1}),t(c,{label:"制卡时间",align:"center",span:2},{default:e(()=>[s(p(n(l).createTime),1)]),_:1}),t(c,{label:"制卡批号",align:"center",span:2},{default:e(()=>[s(p(n(l).carmiPch),1)]),_:1}),t(c,{label:"卡号备注",align:"center",span:2},{default:e(()=>[s(p(n(l).carmiNotes),1)]),_:1})]),_:1}),Ce,t(u,{class:"margin-top",column:"2",size:"small",border:""},{default:e(()=>[t(c,{label:"制卡人",align:"center"},{default:e(()=>[s(p(n(l).makingUser),1)]),_:1}),t(c,{label:"制卡金额",align:"center"},{default:e(()=>[s(p(n(l).makingMoney)+"￥",1)]),_:1}),t(c,{label:"充值用户",align:"center"},{default:e(()=>[s(p(n(l).useUser),1)]),_:1}),t(c,{label:"充值时间",align:"center"},{default:e(()=>[s(p(n(l).useTime),1)]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ue={__name:"carmit-search",emits:["search"],setup(i,{emit:a}){const d=a,{form:_,resetFields:k}=z({carmitName:""}),V=()=>{d("search",_)},l=()=>{k(),V()};return(E,v)=>{const x=K,N=H,h=A,c=D,g=q,u=L;return T(),B(u,{"label-width":"60px",size:"small",class:"demo-search"},{default:e(()=>[t(g,null,{default:e(()=>[t(h,{lg:8,md:8,sm:24,xs:24},{default:e(()=>[t(N,{label:"卡种名"},{default:e(()=>[t(x,{clearable:"",modelValue:n(_).carmitName,"onUpdate:modelValue":v[0]||(v[0]=o=>n(_).carmitName=o),modelModifiers:{trim:!0},placeholder:`请输入
`},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:8,md:8,sm:24,xs:24},{default:e(()=>[t(N,{"label-width":"12px"},{default:e(()=>[t(c,{type:"primary",onClick:V},{default:e(()=>[s("查询")]),_:1}),t(c,{onClick:l},{default:e(()=>[s("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Pe=ue(Ue,[["__scopeId","data-v-66151c56"]]);function Se(i){return U(this,null,function*(){const a=yield S.get("/agent/carmi/carmitInfo?id="+i);return a.data.code===0?a.data.data:Promise.reject(new Error(a.data.message))})}function Te(i){return U(this,null,function*(){const a=yield S.get("/agent/carmi/carmitPage",{params:i});return a.data.code===0?a.data.data:Promise.reject(new Error(a.data.message))})}function Ie(i){return U(this,null,function*(){const a=yield S.get("/agent/carmi/page",{params:i});return a.data.code===0?a.data.data:Promise.reject(new Error(a.data.message))})}function Be(i){return U(this,null,function*(){const a=yield S.post("/agent/carmi/save",i);return a.data.code===0?a.data.message:Promise.reject(new Error(a.data.message))})}function De(i){return U(this,null,function*(){const a=yield S.delete("/agent/carmi/remove?id="+i);return a.data.code===0?a.data.message:Promise.reject(new Error(a.data.message))})}function $e(i){return U(this,null,function*(){const a=yield S.delete("/agent/carmi/unlock",{data:i});return a.data.code===0?a.data.message:Promise.reject(new Error(a.data.message))})}function We(i){return U(this,null,function*(){const a=yield S.delete("/agent/carmi/lock",{data:i});return a.data.code===0?a.data.message:Promise.reject(new Error(a.data.message))})}function je(i){return U(this,null,function*(){const a=yield S.delete("/agent/carmi/sold",{data:i});return a.data.code===0?a.data.message:Promise.reject(new Error(a.data.message))})}const Fe={key:1},Oe={__name:"carmi-add",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(i,{emit:a}){const d=a,_=w(!1),k=w(null),V=w(!0),{form:l,resetFields:E,assignFields:v}=z({carmitId:void 0,carmitName:"",softName:"",carmitPrefix:"",carmitTime:"",carmitPoint:"",carmitBind:"",carmitOpening:"",carmitNotes:"",addCount:void 0}),x=pe({datasource:({page:g,limit:u,where:o,orders:m})=>Te(F(I(I({},o),m),{page:g,limit:u,type:1})),columns:[{prop:"carmitName",label:"卡种名称",minWidth:140,fixed:"left"},{prop:"softName",label:"所属软件",minWidth:120},{prop:"carmitTime",label:"充值时间",minWidth:200,formatter:g=>g.carmitTime+"分钟（"+(g.carmitTime/1440).toFixed(2)+"天）"},{prop:"carmitPoint",label:"充值点数",align:"center",minWidth:100},{prop:"carmitBind",label:"绑定数量",align:"center",minWidth:100},{prop:"carmitOpening",label:"通道数量",align:"center",minWidth:100}],showOverflowTooltip:!0,toolbar:!1,pagination:{pageSize:6,layout:"total, prev, pager, next, jumper",style:{padding:"0px"}},rowClickChecked:!0}),N=g=>{var u,o,m;(m=(o=(u=selectRef.value)==null?void 0:u.tableRef)==null?void 0:o.reload)==null||m.call(o,{where:g,page:1})},h=()=>{var g,u;(u=(g=k.value)==null?void 0:g.validate)==null||u.call(g,o=>{if(!o)return;_.value=!0,Be(l).then(r=>{_.value=!1,y.success(r),c(!1),d("done")}).catch(r=>{_.value=!1,y.error(r.message)})})},c=g=>{d("update:modelValue",g)};return X(()=>l.carmitId,(g,u)=>{Se(g).then(o=>{l.carmitName=o.carmitName,l.softName=o.softName,l.carmitPrefix=o.carmitPrefix,l.carmitTime=o.carmitTime,l.carmitPoint=o.carmitPoint,l.carmitBind=o.carmitBind,l.carmitOpening=o.carmitOpening,l.carmitNotes=o.carmitNotes}).catch(o=>{y.error(o.message)})}),(g,u)=>{const o=ae,m=le,r=ke,b=H,f=A,$=K,M=q,W=L,j=D,R=ee;return T(),B(R,{form:"",width:640,"model-value":i.modelValue,title:"生产充值卡","onUpdate:modelValue":c},{footer:e(()=>[t(j,{onClick:u[3]||(u[3]=P=>c(!1))},{default:e(()=>[s("取消")]),_:1}),t(j,{type:"primary",loading:_.value,onClick:h},{default:e(()=>[s(" 生产 ")]),_:1},8,["loading"])]),default:e(()=>[n(l).carmitId>0?(T(),B(m,{key:0,class:"margin-top",column:"2",size:"small",border:""},{default:e(()=>[t(o,{label:"卡种名称",align:"center",span:2},{default:e(()=>[s(p(n(l).carmitName),1)]),_:1}),t(o,{label:"所属软件",align:"center"},{default:e(()=>[s(p(n(l).softName),1)]),_:1}),t(o,{label:"卡头前缀",align:"center"},{default:e(()=>[s(p(n(l).carmitPrefix),1)]),_:1}),t(o,{label:"充值时间",align:"center"},{default:e(()=>[s(p(n(l).carmitTime),1)]),_:1}),t(o,{label:"充值点数",align:"center"},{default:e(()=>[s(p(n(l).carmitPoint),1)]),_:1}),t(o,{label:"通道数量",align:"center"},{default:e(()=>[s(p(n(l).carmitOpening),1)]),_:1}),t(o,{label:"绑定数量",align:"center"},{default:e(()=>[s(p(n(l).carmitBind),1)]),_:1}),t(o,{label:"卡号备注",align:"center",span:2},{default:e(()=>[s(p(n(l).carmitNotes),1)]),_:1})]),_:1})):Q("",!0),n(l).carmitId>0?(T(),_e("br",Fe)):Q("",!0),t(W,{ref_key:"formRef",ref:k,model:n(l),"label-width":"80px"},{default:e(()=>[t(M,{gutter:16},{default:e(()=>[t(f,{lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(b,{label:"选择卡种",prop:"url"},{default:e(()=>[t(r,{ref:"selectRef",clearable:"",placeholder:"请选择卡种信息","value-key":"carmitId","label-key":"carmitName",modelValue:n(l).carmitId,"onUpdate:modelValue":u[0]||(u[0]=P=>n(l).carmitId=P),"table-props":x,"popper-width":580,border:V.value},{default:e(()=>[t(Pe,{onSearch:N})]),_:1},8,["modelValue","table-props","border"])]),_:1})]),_:1}),t(f,{lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(b,{label:"生产数量",prop:"addCount"},{default:e(()=>[t($,{clearable:"",modelValue:n(l).addCount,"onUpdate:modelValue":u[1]||(u[1]=P=>n(l).addCount=P)},{append:e(()=>[s("张")]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(f,{lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(b,{label:"卡号备注",prop:"carmiNotes"},{default:e(()=>[t($,{clearable:"",modelValue:n(l).carmitNotes,"onUpdate:modelValue":u[2]||(u[2]=P=>n(l).carmitNotes=P)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}},ze=Y("span",null,"批量操作",-1),Me={name:"AgentCarmi"},Ye=Object.assign(Me,{setup(i){const a=w(null),d=fe(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"carmiStr",label:"充值卡号",minWidth:260},{prop:"carmiStatus",label:"状态",width:90,align:"center",slot:"carmiStatus"},{prop:"carmiName",label:"充值卡名",minWidth:120},{prop:"softName",label:"所属软件",minWidth:160},{prop:"makingUser",label:"制卡人",minWidth:120},{prop:"createTime",label:"制卡时间",width:180},{prop:"carmiNotes",label:"备注",minWidth:160},{prop:"useUser",label:"充值用户",minWidth:120},{prop:"useTime",label:"充值时间",minWidth:180},{prop:"carmiPch",label:"批次号",minWidth:180},{columnKey:"action",label:"操作",width:130,align:"center",slot:"action",fixed:"right"}]),_=w([]),k=w(!0),V=w(!1);w(!0);const l=w(!0),E=w(null),v=w(!1),x=w(!1),N=({page:m,limit:r,where:b,orders:f})=>Ie(F(I(I({},b),f),{page:m,limit:r})),h=m=>{var r,b;_.value=[],(b=(r=a.value)==null?void 0:r.reload)==null||b.call(r,{page:1,where:m})},c=m=>{E.value=m!=null?m:null,v.value=!0},g=()=>{x.value=!0},u=m=>{O.confirm("确定要删除“"+m.carmiName+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const r=y.loading("请求中..");De(m.carmiId).then(b=>{r.close(),y.success(b),h()}).catch(b=>{r.close(),y.error(b.message)})}).catch(()=>{})},o=m=>{if(m==="lock"){const r=_.value;if(!r.length){y.error("请至少选择一条数据");return}O.confirm('确定要 <b style="color:red">锁定</b> 选中充值卡吗？<br><span style="font-size:12px;color:blue">只有未使用的充值卡才可被锁定</span>',"系统提示",{type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{const b=y.loading("请求中..");We(r.map(f=>f.carmiId)).then(f=>{b.close(),y.success(f),h()}).catch(f=>{b.close(),y.error(f.message)})}).catch(()=>{})}else if(m==="unlock"){const r=_.value;if(!r.length){y.error("请至少选择一条数据");return}O.confirm("确定要解锁选中充值卡吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const b=y.loading("请求中..");$e(r.map(f=>f.carmiId)).then(f=>{b.close(),y.success(f),h()}).catch(f=>{b.close(),y.error(f.message)})}).catch(()=>{})}else if(m==="sold"){const r=_.value;if(!r.length){y.error("请至少选择一条数据");return}O.confirm('确定要修选中充值卡为  <b style="color:#FF6600">售出</b> 状态吗？<br><span style="font-size:12px;color:blue">售出状态一般用于记录，防止重复发卡</span>',"系统提示",{type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{const b=y.loading("请求中..");je(r.map(f=>f.carmiId)).then(f=>{b.close(),y.success(f),h()}).catch(f=>{b.close(),y.error(f.message)})}).catch(()=>{})}};return(m,r)=>{const b=D,f=he,$=ve,M=Z,W=ye,j=xe,R=we,P=te,ne=Ve;return T(),B(ne,{"hide-footer":"","flex-table":l.value},{default:e(()=>[t(Ne,{onSearch:h}),t(P,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":l.value},{default:e(()=>[t(R,{ref_key:"tableRef",ref:a,"row-key":"carmiId",columns:d.value,datasource:N,current:E.value,"onUpdate:current":r[1]||(r[1]=C=>E.value=C),selections:_.value,"onUpdate:selections":r[2]||(r[2]=C=>_.value=C),"show-overflow-tooltip":!0,"highlight-current-row":"",stripe:V.value,border:k.value,pagination:{pageSize:20}},{toolbar:e(()=>[t(b,{type:"primary",class:"ele-btn-icon",icon:n(ge),onClick:r[0]||(r[0]=C=>g())},{default:e(()=>[s(" 制卡 ")]),_:1},8,["icon"]),t($,{items:[{title:"批量售出",command:"sold"},{title:"批量锁卡",command:"lock"},{title:"批量解锁",command:"unlock"}],style:{"margin-left":"12px"},onCommand:o},{default:e(()=>[t(b,{class:"ele-btn-icon"},{default:e(()=>[ze,t(f,{size:12,style:{margin:"0 -4px 0 4px"}},{default:e(()=>[t(n(be))]),_:1})]),_:1})]),_:1})]),carmiStatus:e(({row:C})=>[t(M,{class:"ml-2",type:C.carmiStatus_style},{default:e(()=>[s(p(C.carmiStatus),1)]),_:2},1032,["type"])]),action:e(({row:C})=>[t(W,{type:"primary",underline:!1,onClick:oe=>c(C)},{default:e(()=>[s(" 查看 ")]),_:2},1032,["onClick"]),t(j,{direction:"vertical"}),t(W,{type:"danger",underline:!1,onClick:oe=>u(C)},{default:e(()=>[s(" 退卡 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","current","selections","stripe","border"])]),_:1},8,["flex-table"]),t(Ee,{modelValue:v.value,"onUpdate:modelValue":r[3]||(r[3]=C=>v.value=C),data:E.value,onDone:h},null,8,["modelValue","data"]),t(Oe,{modelValue:x.value,"onUpdate:modelValue":r[4]||(r[4]=C=>x.value=C),onDone:h},null,8,["modelValue"])]),_:1},8,["flex-table"])}}});export{Ye as default};
