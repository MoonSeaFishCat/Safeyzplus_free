var j=Object.defineProperty,I=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var U=(c,r,a)=>r in c?j(c,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[r]=a,z=(c,r)=>{for(var a in r||(r={}))q.call(r,a)&&U(c,a,r[a]);if(B)for(var a of B(r))W.call(r,a)&&U(c,a,r[a]);return c},C=(c,r)=>I(c,R(r));import{u as G,o as M,c as N,w as l,a as H,b as h,d as t,e as m,E as L,f as P,g as K,h as Q,ap as A,v as J,r as g,aq as X,Q as Y,t as F,q as i,z as Z,k as ee,C as te,D as le}from"./index-DKVio5DX.js";import{i as $}from"./index-1zv9CzUI.js";import{i as ae}from"./index-JCBdu9eJ.js";import"./index-hd5M_H5A.js";import{E as oe}from"./upload-eKglZPjX.js";import"./progress-5PMSkHEP.js";import{E as ne,a as se}from"./col-Ru1YGmP5.js";import{p as re,r as ie,u as ce}from"./index-94H0BTDC.js";import{i as de}from"./index-C8m5DZvo.js";const ue={__name:"file-search",emits:["search"],setup(c,{emit:r}){const a=r,{form:d,resetFields:v}=G({name:"",path:"",createNickname:""}),p=()=>{a("search",d)},k=()=>{v(),p()};return(V,u)=>{const x=L,_=P,b=ne,y=K,e=se,o=Q,s=$;return M(),N(s,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[t(o,{"label-width":"72px",onKeyup:H(p,["enter"])},{default:l(()=>[t(e,{gutter:8},{default:l(()=>[t(b,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(_,{label:"文件名称"},{default:l(()=>[t(x,{clearable:"",modelValue:h(d).name,"onUpdate:modelValue":u[0]||(u[0]=n=>h(d).name=n),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(_,{label:"文件路径"},{default:l(()=>[t(x,{clearable:"",modelValue:h(d).path,"onUpdate:modelValue":u[1]||(u[1]=n=>h(d).path=n),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(_,{label:"上传人"},{default:l(()=>[t(x,{clearable:"",modelValue:h(d).createNickname,"onUpdate:modelValue":u[2]||(u[2]=n=>h(d).createNickname=n),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(_,{"label-width":"16px"},{default:l(()=>[t(y,{type:"primary",onClick:p},{default:l(()=>[m("查询")]),_:1}),t(y,{onClick:k},{default:l(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},me={name:"ProjectFile"},we=Object.assign(me,{setup(c){const r=A(),a=J(()=>{var e;return(e=r.info)!=null?e:{}}),d=g(null),v=g([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名称",sortable:"custom",minWidth:120},{prop:"path",label:"文件路径",sortable:"custom",minWidth:120,slot:"path"},{prop:"length",label:"文件大小",width:120,align:"center",sortable:"custom",formatter:e=>e.length<1024?e.length+"B":e.length<1024*1024?(e.length/1024).toFixed(1)+"KB":e.length<1024*1024*1024?(e.length/1024/1024).toFixed(1)+"M":(e.length/1024/1024/1024).toFixed(1)+"G"},{prop:"createNickname",label:"上传人",width:120,align:"center",sortable:"custom"},{prop:"createTime",label:"上传时间",width:160,align:"center",sortable:"custom"},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action"}]),p=g([]);g(null);const k=g(!0),V=g(!1);g(!0);const u=g(!0),x=({page:e,limit:o,where:s,orders:n})=>re(C(z(z({},s),n),{page:e,limit:o})),_=e=>{var o,s;p.value=[],(s=(o=d.value)==null?void 0:o.reload)==null||s.call(o,{page:1,where:e})},b=e=>{const o=e==null?p.value:[e];if(!o.length){i.error("请至少选择一条数据");return}Z.confirm("确定要删除“"+o.map(s=>s.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const s=i.loading("请求中..");ie(o.map(n=>n.id)).then(n=>{s.close(),i.success(n),_()}).catch(n=>{s.close(),i.error(n.message)})}).catch(()=>{})},y=e=>{const o=e.name,s=o.slice(o.lastIndexOf(".")+1);if(a.value.pan_file_type.indexOf(e.type)==-1)return i.error("该类型["+e.type+"]文件不可上传"),!1;if(a.value.pan_file_exename.indexOf(s)==-1)return i.error("该扩展名["+s+"]文件不可上传"),!1;if(e.size/1024/1024>a.value.pan_file_size_max)return i.error("上传文件大小不能超过 "+a.value.pan_file_size_max+"MB"),!1;if(a.value.pan_size>=a.value.pan_size_max)return i.error("网盘容量已达到上限"),!1;if(a.value.pan_size+e.size/1024/1024>=a.value.pan_size_max)return i.error("网盘剩余容量不足以上传该文件"),!1;const n=i.loading({message:"上传中..",mask:!0});return ce(e).then(()=>{n.close(),i.success("上传成功"),_()}).catch(E=>{n.close(),i.error(E.message)}),!1};return(e,o)=>{const s=K,n=oe,E=ee,w=te,D=le,O=ae,S=$,T=de;return M(),N(T,{"hide-footer":"","flex-table":u.value,style:{"min-height":"600px"}},{default:l(()=>[t(ue,{onSearch:_}),t(S,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":u.value},{default:l(()=>[t(O,{ref_key:"tableRef",ref:d,"row-key":"id",columns:v.value,datasource:x,"show-overflow-tooltip":!0,selections:p.value,"onUpdate:selections":o[1]||(o[1]=f=>p.value=f),"highlight-current-row":"","cache-key":"systemFileTable",stripe:V.value,border:k.value},{toolbar:l(()=>[t(n,{action:"","show-upload-list":!1,"before-upload":y,style:{display:"inline-block","vertical-align":"middle"}},{default:l(()=>[t(s,{type:"primary",class:"ele-btn-icon",icon:h(X)},{default:l(()=>[m(" 上传 ")]),_:1},8,["icon"])]),_:1}),t(s,{type:"danger",class:"ele-btn-icon",icon:h(Y),style:{"margin-left":"12px"},onClick:o[0]||(o[0]=f=>b())},{default:l(()=>[m(" 删除 ")]),_:1},8,["icon"]),m("   "),t(E,{type:"info",size:"large"},{default:l(()=>[m(F(a.value.pan_size)+"/"+F(a.value.pan_size_max)+"MB",1)]),_:1})]),path:l(({row:f})=>[t(w,{type:"primary",href:f.url,target:"_blank",underline:!1},{default:l(()=>[m(F(f.path),1)]),_:2},1032,["href"])]),action:l(({row:f})=>[t(w,{type:"primary",underline:!1,href:f.downloadUrl,target:"_blank"},{default:l(()=>[m(" 下载 ")]),_:2},1032,["href"]),t(D,{direction:"vertical"}),t(w,{type:"danger",underline:!1,onClick:pe=>b(f)},{default:l(()=>[m(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections","stripe","border"])]),_:1},8,["flex-table"])]),_:1},8,["flex-table"])}}});export{we as default};
