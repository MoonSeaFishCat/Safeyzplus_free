var U=(a,o,c)=>new Promise((V,_)=>{var b=n=>{try{p(c.next(n))}catch(e){_(e)}},v=n=>{try{p(c.throw(n))}catch(e){_(e)}},p=n=>n.done?V(n.value):Promise.resolve(n.value).then(b,v);p((c=c.apply(a,o)).next())});import{a9 as G,A as J,aa as Z,ab as Q,ac as W,r as k,Z as S,o as m,c as E,w as r,F as X,ad as Y,ae as ee,a6 as ae,n as I,t as C,p as P,af as oe,G as le,ag as se,s as z,ah as te,_ as re,ai as ne,O as de,P as ue,b as s,m as ce,v as ie,aj as pe,d as t,q as w,j as f,ak as me,al as F,am as $,an as L,e as q,a as O,E as ge,f as fe,ao as _e,g as be,h as ve,M as he,N as Ve}from"./index-DKVio5DX.js";import{i as we}from"./index-1zv9CzUI.js";const ye={modelValue:[String,Number],block:Boolean,disabled:Boolean,items:{type:Array,required:!0},size:String},ke={"update:modelValue":a=>!0,change:a=>!0},Ee=G({name:"EleSegmented",components:{ElIcon:J,ElTabs:Z,ElTabPane:Q},props:ye,emits:ke,setup(a,{emit:o}){const{authenticated:c}=W();return{tabRef:k(null),onUpdateModelValue:b=>{c.value&&a.modelValue!==b&&(o("update:modelValue",b),o("change",b))}}}}),xe=(a,o)=>{const c=a.__vccOpts||a;for(const[V,_]of o)c[V]=_;return c},Ce={key:1,class:"ele-segmented-item-label"};function Pe(a,o,c,V,_,b){const v=S("ElIcon"),p=S("ElTabPane"),n=S("ElTabs");return m(),E(n,{ref:"tabRef",modelValue:a.modelValue,stretch:a.block,class:se(["ele-segmented",{"is-block":a.block},{"is-large":a.size==="large"},{"is-small":a.size==="small"},{"is-disabled":a.disabled}]),"onUpdate:modelValue":a.onUpdateModelValue},{default:r(()=>[(m(!0),P(X,null,le(a.items,(e,T)=>(m(),E(p,{key:T+"-"+e.value+"-"+e.label,name:e.value,disabled:a.disabled||e.disabled},{label:r(()=>[oe(a.$slots,"label",{item:e},()=>[e.icon?(m(),E(v,Y({key:0},e.iconProps||{},{class:"ele-segmented-item-icon"}),{default:r(()=>[(m(),E(ee(e.icon),{style:ae(e.iconStyle)},null,8,["style"]))]),_:2},1040)):I("",!0),e.label?(m(),P("div",Ce,C(e.label),1)):I("",!0)])]),_:2},1032,["name","disabled"]))),128))]),_:3},8,["modelValue","stretch","class","onUpdate:modelValue"])}const Te=xe(Ee,[["render",Pe]]);function Ue(a){return U(this,null,function*(){var c;const o=yield z.post("/login",a);return o.data.code===0?(te((c=o.data.data)==null?void 0:c.access_token,a.remember),o.data.message):Promise.reject(new Error(o.data.message))})}function Ie(a){return U(this,null,function*(){const o=yield z.post("/reg",a);return o.data.code===0?o.data.message:Promise.reject(new Error(o.data.message))})}function Re(){return U(this,null,function*(){const a=yield z.get("/captcha");return a.data.code===0&&a.data.data?a.data.data:Promise.reject(new Error(a.data.message))})}const K=a=>(he("data-v-15d5f320"),a=a(),Ve(),a),Se={class:"login-wrapper"},$e={class:"login-cover"},qe={class:"login-title"},ze=K(()=>f("h4",{class:"login-subtitle"},"安全稳定、性能强悍、服务器集群架设",-1)),Be={class:"login-body"},Ne=K(()=>f("br",null,null,-1)),je={class:"login-captcha-group"},Me=["src"],Ae={class:"login-captcha-group"},Fe=["src"],Le={__name:"index",setup(a){const{t:o}=ne.useI18n(),{currentRoute:c}=de(),{goHomeRoute:V,cleanPageTabs:_}=ue(),{query:b}=s(c),v=k(1),p=k(),n=k(!1),e=ce({username:"",password:"",password_2:"",code:"",authorId:"",remember:!1});e.authorId=b.sid;const T=ie(()=>({username:[{required:!0,message:o("login.username"),type:"string",trigger:"blur"}],password:[{required:!0,message:o("login.password"),type:"string",trigger:"blur"}],password_2:[{required:!0,message:o("login.password_2"),type:"string",trigger:"blur"}],code:[{required:!0,message:o("login.code"),type:"string",trigger:"blur"}]})),x=k(""),R=k(""),B=()=>{var d,l;(l=(d=p.value)==null?void 0:d.validate)==null||l.call(d,h=>{if(!h)return!1;if(e.code.toLowerCase()!==R.value){w.error("验证码错误");return}n.value=!0,Ue(e).then(i=>{w.success(i),_(),j()}).catch(i=>{n.value=!1,w.error(i.message),y()})})},N=()=>{var d,l;(l=(d=p.value)==null?void 0:d.validate)==null||l.call(d,h=>{if(!h)return!1;if(e.code.toLowerCase()!==R.value){w.error("验证码错误");return}n.value=!0,Ie(e).then(i=>{n.value=!1,w.success(i),y(),v.value=1}).catch(i=>{n.value=!1,w.error(i.message),y()})})},y=()=>{Re().then(d=>{var l,h;x.value=d.base64,R.value=d.text,(h=(l=p.value)==null?void 0:l.clearValidate)==null||h.call(l)}).catch(d=>{w.error(d.message)})},j=()=>{const{query:d}=s(c);V(d.from)};return pe()?j():y(),(d,l)=>{const h=Te,i=ge,g=fe,D=_e,M=be,A=ve,H=we;return m(),P("div",Se,[t(H,{shadow:"always",class:"login-card"},{default:r(()=>[f("div",$e,[f("h1",qe,C(s(me)),1),ze]),f("div",Be,[Ne,t(h,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=u=>v.value=u),items:[{label:s(o)("login.loginType"),value:1},{label:s(o)("login.regType"),value:2}],style:{"margin-bottom":"18px"}},null,8,["modelValue","items"]),v.value==1?(m(),E(A,{key:0,ref_key:"formRef",ref:p,size:"large",model:e,rules:T.value,onKeyup:O(B,["enter"])},{default:r(()=>[t(g,{prop:"username"},{default:r(()=>[t(i,{clearable:"",modelValue:e.username,"onUpdate:modelValue":l[1]||(l[1]=u=>e.username=u),placeholder:s(o)("login.username"),"prefix-icon":s(F)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),t(g,{prop:"password"},{default:r(()=>[t(i,{"show-password":"",modelValue:e.password,"onUpdate:modelValue":l[2]||(l[2]=u=>e.password=u),placeholder:s(o)("login.password"),"prefix-icon":s($)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),t(g,{prop:"code"},{default:r(()=>[f("div",je,[t(i,{clearable:"",modelValue:e.code,"onUpdate:modelValue":l[3]||(l[3]=u=>e.code=u),placeholder:s(o)("login.code"),"prefix-icon":s(L)},null,8,["modelValue","placeholder","prefix-icon"]),f("div",{class:"login-captcha",onClick:y},[x.value?(m(),P("img",{key:0,src:x.value},null,8,Me)):I("",!0)])])]),_:1}),t(g,null,{default:r(()=>[t(D,{modelValue:e.remember,"onUpdate:modelValue":l[4]||(l[4]=u=>e.remember=u)},{default:r(()=>[q(C(s(o)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:r(()=>[t(M,{size:"large",type:"primary",loading:n.value,style:{width:"100%"},onClick:B},{default:r(()=>[q(C(s(o)("login.login")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):(m(),E(A,{key:1,ref_key:"formRef",ref:p,size:"large",model:e,rules:T.value,onKeyup:O(N,["enter"])},{default:r(()=>[t(g,{prop:"username"},{default:r(()=>[t(i,{clearable:"",modelValue:e.username,"onUpdate:modelValue":l[5]||(l[5]=u=>e.username=u),placeholder:s(o)("login.username"),"prefix-icon":s(F)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),t(g,{prop:"password"},{default:r(()=>[t(i,{"show-password":"",modelValue:e.password,"onUpdate:modelValue":l[6]||(l[6]=u=>e.password=u),placeholder:s(o)("login.password"),"prefix-icon":s($)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),t(g,{prop:"password_2"},{default:r(()=>[t(i,{"show-password":"",modelValue:e.password_2,"onUpdate:modelValue":l[7]||(l[7]=u=>e.password_2=u),placeholder:s(o)("login.password_2"),"prefix-icon":s($)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),t(g,{prop:"code"},{default:r(()=>[f("div",Ae,[t(i,{clearable:"",modelValue:e.code,"onUpdate:modelValue":l[8]||(l[8]=u=>e.code=u),placeholder:s(o)("login.code"),"prefix-icon":s(L)},null,8,["modelValue","placeholder","prefix-icon"]),f("div",{class:"login-captcha",onClick:y},[x.value?(m(),P("img",{key:0,src:x.value},null,8,Fe)):I("",!0)])])]),_:1}),t(g,null,{default:r(()=>[t(M,{size:"large",type:"primary",loading:n.value,style:{width:"100%"},onClick:N},{default:r(()=>[q(C(s(o)("login.reg")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]))])]),_:1})])}}},He=re(Le,[["__scopeId","data-v-15d5f320"]]);export{He as default};
