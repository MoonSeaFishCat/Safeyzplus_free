var ae=Object.defineProperty,ne=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var G=(u,r,i)=>r in u?ae(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,z=(u,r)=>{for(var i in r||(r={}))re.call(r,i)&&G(u,i,r[i]);if(L)for(var i of L(r))ie.call(r,i)&&G(u,i,r[i]);return u},F=(u,r)=>ne(u,se(r));import{r as c,u as Q,o as V,c as $,w as e,a as ce,b as T,F as ue,G as de,p as J,d as t,e as s,a7 as me,a8 as pe,f as _e,E as fe,g as O,h as ge,v as X,i as H,j as N,l as Y,d5 as ve,a4 as be,q as U,L as he,C as Z,O as ye,P as xe,m as ke,x as Ve,Q as Ee,aq as we,a6 as Ie,t as B,R as A,S as Ce,z as ze,k as $e,D as Te}from"./index-DKVio5DX.js";import{i as j}from"./index-1zv9CzUI.js";import{i as ee}from"./index-JCBdu9eJ.js";import{v as Ue}from"./index-hd5M_H5A.js";import{E as De}from"./text-lzaRNwcJ.js";import{E as Be,a as Ne}from"./col-Ru1YGmP5.js";import{l as Se}from"./index--y5nxKK5.js";import{E as We}from"./alert-GJy0wCuj.js";import{b as Me,i as Fe,p as Pe,r as Re}from"./index-v5MNGS2a.js";import{E as Ae}from"./upload-eKglZPjX.js";import"./progress-5PMSkHEP.js";import{i as Oe}from"./index-C8m5DZvo.js";const je={__name:"search-form",emits:["search"],setup(u,{emit:r}){const i=r,p=c([]);Se().then(y=>{p.value=y}).catch(y=>{EleMessage.error(y.message)});const{form:v,resetFields:E}=Q({softId:void 0,userAccount:""}),_=()=>{i("search",v)},g=()=>{E(),_()};return(y,n)=>{const k=me,D=pe,w=_e,C=Be,b=fe,d=O,l=Ne,I=ge,S=j;return V(),$(S,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(I,{"label-width":"72px",onKeyup:ce(_,["enter"])},{default:e(()=>[t(l,{gutter:8},{default:e(()=>[t(C,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(w,{label:"所属软件",prop:"softId"},{default:e(()=>[t(D,{clearable:"",modelValue:T(v).softId,"onUpdate:modelValue":n[0]||(n[0]=h=>T(v).softId=h),placeholder:"不限",class:"ele-fluid"},{default:e(()=>[(V(!0),J(ue,null,de(p.value,h=>(V(),$(k,{key:h.softId,value:h.softId,label:h.softName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(C,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(w,{label:"账号"},{default:e(()=>[t(b,{clearable:"",modelValue:T(v).userAccount,"onUpdate:modelValue":n[1]||(n[1]=h=>T(v).userAccount=h),modelModifiers:{trim:!0},placeholder:"搜索账号"},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(w,{"label-width":"16px"},{default:e(()=>[t(d,{type:"primary",onClick:_},{default:e(()=>[s("查询")]),_:1}),t(d,{onClick:g},{default:e(()=>[s("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},qe=N("br",null,null,-1),Ke=N("br",null,null,-1),Le=N("br",null,null,-1),Ge=N("span",{style:{color:"rgba(255, 72, 0, 0.952)"}},"此功能调用方式：使用接口 [历史充值卡_查询] 可用来查询该账户所有已充值的卡的数据，可自行判断到期时间等，使用接口 [历史充值卡_扣点] [历史充值卡_扣时] 可用来扣时扣点",-1),He={__name:"carmi-page",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(u,{emit:r}){const i=r,p=u,v=c(!1);c(!1);const E=c(null),_=c(null);c(!0);const g=c([]),y=X(()=>[{prop:"carmiName",label:"充值卡名",minWidth:120,fixed:"left"},{prop:"carmiStr",label:"充值卡号",minWidth:200},{prop:"useEndtime",label:"激活到期时间",align:"center",minWidth:160},{prop:"usePoint",label:"激活剩余点数",align:"center",minWidth:100},{prop:"useTime",label:"激活时间",align:"center",minWidth:160}]),{form:n,resetFields:k,assignFields:D}=Q({userId:void 0}),w=({page:b,limit:d,where:l,orders:I})=>Me(F(z(z({},l),I),{page:b,limit:d,userId:n.userId})),C=b=>{i("update:modelValue",b)};return H(()=>p.modelValue,b=>{var d,l;b?p.data?(D(F(z({},p.data),{password:""})),v.value=!0):v.value=!1:(k(),(l=(d=E.value)==null?void 0:d.clearValidate)==null||l.call(d))}),H(()=>n.carmitId,(b,d)=>{getData(b).then(l=>{n.carmitId=l.carmitId,n.carmitMoney=l.carmitMoney,n.carmitName=l.carmitName,n.softName=l.softName,n.carmitPrefix=l.carmitPrefix,n.carmitTime=l.carmitTime,n.carmitPoint=l.carmitPoint,n.carmitBind=l.carmitBind,n.carmitOpening=l.carmitOpening,n.carmitNotes=l.carmitNotes}).catch(l=>{})}),(b,d)=>{const l=We,I=ee,S=j,h=O,W=Y;return V(),$(W,{form:"",width:600,"model-value":u.modelValue,title:"历史充值卡","destroy-on-close":!0,responsive:!0,resizable:!0,position:"center","onUpdate:modelValue":C},{footer:e(()=>[t(h,{onClick:d[1]||(d[1]=M=>u.modelValue=!1)},{default:e(()=>[s("关闭")]),_:1})]),default:e(()=>[t(S,{style:{"margin-top":"-20px"},"body-style":{padding:"2px 10px 10px 10px"},"flex-table":!0},{default:e(()=>[t(l,{title:"[单卡激活说明]",type:"success"},{default:e(()=>[s(" 单卡到期时间和单卡剩余点数是针对于自定义计费功能而设计的"),qe,s(" 单卡到期时间：从该卡被充值到账户上开始计算到期时间，和账户的累计到期时间是分开的"),Ke,s(" 单卡剩余点数：从该卡被充值到账户上开始计算点数，和账户的累计充值点数是分开的"),Le,Ge]),_:1}),t(I,{ref_key:"tableRef",ref:_,"row-key":"id",height:"400","max-height":"500",columns:y.value,datasource:w,"show-overflow-tooltip":!0,selections:g.value,"onUpdate:selections":d[0]||(d[0]=M=>g.value=M),"highlight-current-row":"",border:!0,size:"small"},null,8,["columns","selections"])]),_:1})]),_:1},8,["model-value"])}}},Qe={style:{display:"flex","align-items":"center","justify-content":"center"}},Je=N("span",{style:{"padding-right":"8px"}},"只能上传 txt 文件,",-1),Xe={__name:"user-import",props:{modelValue:Boolean},emits:["done","update:modelValue"],setup(u,{emit:r}){const i=r,p=c(!1),v=_=>["text/plain"].includes(_.type)?_.size/1024/1024>20?(U.error("大小不能超过 20MB"),!1):(p.value=!0,Fe(_).then(g=>{p.value=!1,U.success(g),E(!1),i("done")}).catch(g=>{p.value=!1,U.error(g.message)}),!1):(U.error("只能选择 txt 文件"),!1),E=_=>{i("update:modelValue",_)};return(_,g)=>{const y=he,n=Ae,k=Z,D=Y,w=Ue;return V(),$(D,{width:460,title:"导入用户","model-value":u.modelValue,"onUpdate:modelValue":E},{default:e(()=>[be((V(),J("div",null,[t(n,{drag:"",action:"",accept:".txt","show-upload-list":!1,"before-upload":v},{default:e(()=>[t(y,{type:"placeholder",icon:T(ve),"icon-props":{size:68,style:{opacity:.6}}},null,8,["icon"]),t(y,{type:"placeholder"},{default:e(()=>[s("点击选择文件上传")]),_:1})]),_:1})])),[[w,p.value]]),N("div",Qe,[Je,t(k,{type:"primary",underline:!1,href:"https://www.alipan.com/s/fGiszgfz5qH",download:"用户导入模板.txt",target:"_blank"},{default:e(()=>[s(" 下载模板 ")]),_:1})])]),_:1},8,["model-value"])}}},Ye={name:"SoftUser"},mt=Object.assign(Ye,{setup(u){const{push:r}=ye(),{removePageTab:i}=xe(),p=c(!1),v=()=>{p.value=!0},E=c(null),_=c(""),g=ke({}),y=X(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{prop:"userAccount",label:"账号 / 卡号",minWidth:260,slot:"userAccount"},{prop:"softName",label:"所属软件",minWidth:120},{prop:"endtime",label:"过期时间",minWidth:260,slot:"endtime"},{prop:"point",label:"点数",align:"center",minWidth:80},{prop:"opening",label:"通道数量",align:"center",width:100},{prop:"bind",label:"绑定数量",align:"center",width:100},{prop:"regTime",label:"注册时间",minWidth:160},{columnKey:"action",label:"操作",width:150,align:"center",showOverflowTooltip:!1,resizable:!1,slot:"action",fixed:"right"}]),n=c([]),k=c(null),D=c(!0),w=c(!1);c(!0);const C=c(!0),b=({page:m,limit:a,where:x,orders:f,filters:P})=>Pe(F(z(z(z({},x),f),P),{page:m,limit:a})),d=m=>{Object.assign(g,m),M()},l=m=>{var a,x;(x=(a=E.value)==null?void 0:a.reload)==null||x.call(a,{page:1,where:m})},I=c(!1),S=m=>{k.value=m!=null?m:null,I.value=!0},h=m=>{const a=m?"/soft/user/edit":"/soft/user/add";i({key:a}),Ce(()=>{r({path:a,query:m?{id:m.userId}:void 0})})},W=m=>{const a=m==null?n.value:[m];if(!a.length){U.error("请至少选择一条数据");return}ze.confirm("确定要删除选中软件用户吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const x=U.loading("请求中..");Re(a.map(f=>f.userId)).then(f=>{x.close(),U.success(f),l()}).catch(f=>{x.close(),U.error(f.message)})}).catch(()=>{})},M=()=>{_.value?l(z({},g)):l(g)};return(m,a)=>{const x=O,f=$e,P=De,R=Z,q=Te,te=ee,le=j,oe=Oe;return V(),$(oe,{"hide-footer":"","flex-table":C.value,style:{"min-height":"600px"}},{default:e(()=>[t(je,{onSearch:d}),t(le,{"body-style":{padding:"2px 10px 10px 10px"},"flex-table":C.value},{default:e(()=>[t(te,{ref_key:"tableRef",ref:E,"row-key":"userId",columns:y.value,datasource:b,current:k.value,"onUpdate:current":a[2]||(a[2]=o=>k.value=o),selections:n.value,"onUpdate:selections":a[3]||(a[3]=o=>n.value=o),"show-overflow-tooltip":!0,"highlight-current-row":"","row-click-checked":"",stripe:w.value,border:D.value,"default-sort":{prop:"createTime",order:"ascending"},size:"small",pagination:{pageSize:20}},{toolbar:e(()=>[t(x,{type:"primary",icon:T(Ve),class:"ele-btn-icon",onClick:a[0]||(a[0]=o=>h())},{default:e(()=>[s(" 添加 ")]),_:1},8,["icon"]),t(x,{type:"danger",class:"ele-btn-icon",icon:T(Ee),onClick:a[1]||(a[1]=o=>W())},{default:e(()=>[s(" 删除 ")]),_:1},8,["icon"]),t(x,{class:"ele-btn-icon",icon:T(we),onClick:v},{default:e(()=>[s(" 导入 ")]),_:1},8,["icon"])]),userAccount:e(({row:o})=>[t(f,{class:"mx-1",style:Ie(o.userType_style),effect:"dark",size:"small"},{default:e(()=>[s(B(o.userType),1)]),_:2},1032,["style"]),s(" "),t(f,{size:"small",class:"ml-2",type:o.userStatus_style},{default:e(()=>[s(B(o.userStatus),1)]),_:2},1032,["type"]),s(" "+B(o.userAccount),1)]),endtime:e(({row:o})=>[t(f,{size:"small",type:"info"},{default:e(()=>[t(P,{class:"mx-1",type:"info"},{default:e(()=>[s(B(o.endtime),1)]),_:2},1024)]),_:2},1024),s("​ "),o.endtime_sl>0?(V(),$(f,{key:0,size:"small"},{default:e(()=>[s("剩余:"+B(o.endtime_sl)+"天",1)]),_:2},1024)):o.endtime_sl<=0&&o.endtime_sl_s>0?(V(),$(f,{key:1,size:"small"},{default:e(()=>[s("剩余:"+B(o.endtime_sl_s)+"小时",1)]),_:2},1024)):(V(),$(f,{key:2,size:"small",type:"info"},{default:e(()=>[s("已到期")]),_:1}))]),action:e(({row:o})=>[t(R,{type:"warning",underline:!1,onClick:A(K=>S(o),["stop"])},{default:e(()=>[s(" 查卡 ")]),_:2},1032,["onClick"]),t(q,{direction:"vertical"}),t(R,{type:"primary",underline:!1,onClick:A(K=>h(o),["stop"])},{default:e(()=>[s(" 修改 ")]),_:2},1032,["onClick"]),t(q,{direction:"vertical"}),t(R,{type:"danger",underline:!1,onClick:A(K=>W(o),["stop"])},{default:e(()=>[s(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","current","selections","stripe","border"])]),_:1},8,["flex-table"]),t(He,{modelValue:I.value,"onUpdate:modelValue":a[4]||(a[4]=o=>I.value=o),data:k.value,onDone:l},null,8,["modelValue","data"]),t(Xe,{modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=o=>p.value=o),onDone:l},null,8,["modelValue"])]),_:1},8,["flex-table"])}}});export{mt as default};
